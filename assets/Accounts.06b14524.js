import{p as G,n as i,o}from"./rtl.9bf9d968.js";import{Q as P}from"./QSeparator.66c9c541.js";import{a as E,Q}from"./QCard.4f99fc1d.js";import{j as oe,r as h,aI as b,a5 as $,a6 as s,d as e,bb as a,bD as X,ac as u,P as d,M as de,u as m,a3 as B,bE as k,a4 as H}from"./index.104f6ae1.js";import{Q as I}from"./QInput.2343ca30.js";import{Q as ue,c as ce,d as J,f as ne}from"./QCardActions.e5ce3c72.js";import{a as re,Q as q}from"./QBadge.e5611531.js";import{e as _e,a as ie}from"./excel.5d19a2ad.js";import{a as me}from"./use-quasar.f532f3dd.js";import{a as fe,u as K}from"./index.3178a3ef.js";import{u as pe}from"./account-store.77859985.js";import{u as he}from"./auth-store.41816f87.js";import{g as R}from"./get-css-var.23548d6a.js";import"./use-dark.abb6de42.js";import"./module_calls.c637478d.js";import"./helpers.d60dad50.js";const W=[{name:"production_cost",required:!0,label:"Expense",align:"left",field:n=>n.production_cost,format:n=>`${n}`,sortable:!0},{name:"total_sales",required:!0,label:"Expected Sales",align:"left",field:n=>n.total_sales,format:n=>`${n}`,sortable:!0},{name:"expected_cash",align:"center",label:"Expected Cash",field:"expected_cash",sortable:!0},{name:"expected_mpesa",align:"center",label:"Expected Mpesa",field:"expected_mpesa",sortable:!0},{name:"actual_cash",align:"center",label:"Actual Cash",field:"actual_cash",sortable:!0},{name:"actual_mpesa",align:"center",label:"Actual Mpesa",field:"actual_mpesa",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0}],xe={class:"row q-col-gutter-sm q-ml-xs q-mr-sm q-py-sm"},be={class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},ve={class:"text-center q-pa-sm"},ye={style:{color:"#017951"}},ge={class:"row q-pa-sm"},we={class:"q-pa-xs col-xs-12 col-sm-4 col-md-4"},qe=s("hr",null,null,-1),Ae={class:"q-ma-sm"},Ce={class:"q-pa-xs col-xs-12 col-sm-4 col-md-4"},Ee=s("hr",null,null,-1),Qe={class:"q-ma-sm"},$e={class:"q-pa-xs col-xs-12 col-sm-4 col-md-4"},ke={key:0},Se={key:1},Ve=s("hr",null,null,-1),Ne={class:"q-ma-sm"},Te={__name:"AccountsBarCharts",props:["account_store"],setup(n){return oe({title:{text:"Sales vs Expense",align:"left"},chart:{id:"apex-donut"},colors:[R("primary"),R("dark")],markers:{size:5,hover:{sizeOffset:2}},xaxis:{categories:["Sales","Expenses"]}}),h([]),(N,T)=>(b(),$("div",xe,[s("div",be,[e(E,null,{default:a(()=>{var l,x;return[s("div",ve,[s("b",ye,[e(X,{name:"grain"}),u(" Today")])]),e(P,{color:"primary"}),s("div",ge,[s("div",we,[e(E,{dark:"",class:"bg-primary"},{default:a(()=>[e(Q,{class:"text-center"},{default:a(()=>{var r;return[u(" Total Sales "),qe,s("h5",Ae,d((r=n.account_store)==null?void 0:r.total_daily_sales),1)]}),_:1})]),_:1})]),s("div",Ce,[e(E,{dark:"",class:"bg-orange"},{default:a(()=>[e(Q,{class:"text-center"},{default:a(()=>{var r;return[u(" Total Expense "),Ee,s("h5",Qe,d((r=n.account_store)==null?void 0:r.total_daily_expense),1)]}),_:1})]),_:1})]),s("div",$e,[e(E,{dark:"",class:de(`${n.account_store&&((l=n.account_store)==null?void 0:l.total_daily_sales)-((x=n.account_store)==null?void 0:x.total_daily_expense)>0?"bg-blue":"bg-red"}`)},{default:a(()=>[e(Q,{class:"text-center"},{default:a(()=>{var r,v,f,A;return[n.account_store&&((r=n.account_store)==null?void 0:r.total_daily_sales)-((v=n.account_store)==null?void 0:v.total_daily_expense)>0?(b(),$("span",ke," Profit ")):(b(),$("span",Se,"Loss")),Ve,s("h5",Ne,d(((f=n.account_store)==null?void 0:f.total_daily_sales)-((A=n.account_store)==null?void 0:A.total_daily_expense)),1)]}),_:1})]),_:1},8,["class"])])])]}),_:1})])]))}};const De={class:"q-pa-md"},Me={key:0},Be={key:1},Ie=["onClick"],Pe={style:{color:"white"}},Ue={style:{color:"white"}},ze={style:{color:"white"}},Le=s("small",null,[s("i",null,"(Total Sales - Expenses)")],-1),Oe=s("br",null,null,-1),je=s("small",null,[s("i",null,"(Total Sales - Expense)")],-1),Fe={class:"text-center q-pt-sm"},Ge={class:"text-h6"},He={style:{"text-align":"center"}},Je=s("i",null,"Expected Values",-1),Ke=s("hr",null,null,-1),Re=s("br",null,null,-1),We=s("br",null,null,-1),Xe={class:"text-center error_msg"},fa={__name:"Accounts",setup(n){const N=me(),T=fe(),l=pe(),x=he(),r=h(!1),v=h(!1),f=h(!1),A=h(""),S=h(""),p=h(1),y=h(1),D=h(""),C=h(""),{data:U,isLoading:Y,isError:z}=K("accounts",()=>l.fetchAccounts());K("account_stats_today",()=>l.fetchTodaySalesStats());const Z=()=>{S.value="Close Accounts for the day",r.value=!0,v.value=!1},ee=_=>{v.value=!0,S.value=`Edit Account for ${_.created_at}`,D.value=_.uuid,p.value=_.actual_cash,y.value=_.actual_mpesa,r.value=!0},ae=async()=>{var t,M,L,O,j,F;f.value=!0,C.value="";const _=[];(L=(M=(t=x==null?void 0:x.user)==null?void 0:t.user)==null?void 0:M.departments)==null||L.forEach(w=>_.push(w.name));const c=[];if((F=(j=(O=x==null?void 0:x.user)==null?void 0:O.user)==null?void 0:j.roles)==null||F.forEach(w=>c.push(w.name)),c.includes("Admin")||c.includes("Cashier")){const w={user_departments:_,actual_cash:Number(p.value),actual_mpesa:Number(y.value),expected_cash:l==null?void 0:l.total_daily_cash_sales,expected_mpesa:l==null?void 0:l.total_daily_mpesa_sales,expected_mpesa_cash:l==null?void 0:l.total_daily_mpesa_cash_sales,expected_card:l==null?void 0:l.total_daily_card_sales,expected_debt:l==null?void 0:l.total_daily_debt_sales,total_sales:l==null?void 0:l.total_daily_sales,total_expense:l==null?void 0:l.total_daily_expense};if(w.actual_cash&&w.actual_mpesa){const V=await l.createAccount(w);V.status==="success"?(T.refetchQueries("accounts"),p.value=1,y.value=1,r.value=!1,g(V.message,"green","top"),f.value=!1):(C.value=V.message,g(V.message,"red","top-right"),f.value=!1)}else C.value="Name is required!",g("Name is required!","red","top-right"),f.value=!1}else g("Permission denied! Only cashier or admin is allowed","red","top")},le=async()=>{f.value=!0;const _={account_uuid:D.value,actual_cash:Number(p.value),actual_mpesa:Number(y.value),expected_cash:l==null?void 0:l.total_daily_cash_sales,expected_mpesa:l==null?void 0:l.total_daily_mpesa_sales,expected_mpesa_cash:l==null?void 0:l.total_daily_mpesa_cash_sales,expected_card:l==null?void 0:l.total_daily_card_sales,expected_debt:l==null?void 0:l.total_daily_debt_sales,total_sales:l==null?void 0:l.total_daily_sales,total_expense:l==null?void 0:l.total_daily_expense};if(_.actual_cash&&_.actual_mpesa){const c=await l.updateAccount(_);c.status==="success"?(T.refetchQueries("accounts"),p.value=1,y.value=1,r.value=!1,v.value=!1,S.value="",g(c.message,"green","top"),f.value=!1):(f.value=!1,g("There was an error","red","top-right"))}else C.value="Name is required!",g("Name is required!","red","top-right"),f.value=!1},te=()=>{r.value=!1,p.value=1,y.value=1,D.value="",C.value=""},g=(_,c,t)=>{N.notify({message:_,color:c,position:t})},se=_=>{const c=_.map(t=>({name:t.name,users:t.users.length,created_at:t.created_at}));_e(c,W,ie,N,"AccountsData")};return(_,c)=>(b(),$("div",De,[e(Te,{account_store:m(l)},null,8,["account_store"]),m(Y)?(b(),$("div",Me,"Loading accounts...")):m(z)?(b(),$("div",Be,"An error has occurred: "+d(m(z)),1)):(b(),B(ue,{key:2,title:"Accounts",rows:m(U),columns:m(W),separator:"cell","row-key":"name",filter:A.value,dense:"",grid:""},{item:a(t=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 select_account",style:{cursor:"pointer"},onClick:M=>ee(t.row)},[e(E,{bordered:"",ripple:"",style:{border:"1px solid orange"}},{default:a(()=>[e(Q,null,{default:a(()=>[e(G,{dense:"",bordered:"",separator:""},{default:a(()=>[e(i,{class:"bg-primary text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Accounts closed on ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",Pe,d(t.row.created_at),1)]),_:2},1024)]),_:2},1024),e(i,{class:"bg-blue text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Accounts closed by ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",Ue,d(t.row.user),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.total_sales),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_cash),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_mpesa),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Mpesa $ Cash")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_mpesa_cash),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Card")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_card),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Debt")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_debt),1)]),_:2},1024)]),_:2},1024),e(i,{class:"bg-orange text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Expenses ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",ze,d(t.row.production_cost),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Profit "),Le]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(P,{color:"primary"}),u(),Oe,e(P,{color:"orange"}),e(G,{dense:"",bordered:"",separator:""},{default:a(()=>[e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_total_sales),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_cash),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_mpesa),1)]),_:2},1024)]),_:2},1024),e(i,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Profit "),je]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),s("div",Fe,[s("small",null,[s("i",null,"Department: "+d(t.row.department),1)])])]),_:2},1024)]),_:2},1024)],8,Ie)]),"top-right":a(()=>[e(I,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:A.value,"onUpdate:modelValue":c[0]||(c[0]=t=>A.value=t),placeholder:"Search",class:"q-mr-md"},{append:a(()=>[e(X,{name:"search"})]),_:1},8,["modelValue"]),e(k,{onClick:Z,round:"",dense:"",color:"primary",size:"small",icon:"add"}),e(k,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:c[1]||(c[1]=t=>se(m(U)))})]),_:1},8,["rows","columns","filter"])),e(ce,{modelValue:r.value,"onUpdate:modelValue":c[4]||(c[4]=t=>r.value=t),persistent:""},{default:a(()=>[e(E,{style:{width:"700px"}},{default:a(()=>[e(re,null,{default:a(()=>[s("div",Ge,d(S.value),1),e(J),s("small",He,[Je,Ke,e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Total: "+d((t=m(l))==null?void 0:t.total_daily_sales),1)]}),_:1}),e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Cash: "+d((t=m(l))==null?void 0:t.total_daily_cash_sales),1)]}),_:1}),e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Mpesa: "+d((t=m(l))==null?void 0:t.total_daily_mpesa_sales),1)]}),_:1}),Re,e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Mpesa & Cash: "+d((t=m(l))==null?void 0:t.total_daily_mpesa_cash_sales),1)]}),_:1}),e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Card: "+d((t=m(l))==null?void 0:t.total_daily_card_sales),1)]}),_:1}),e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Debt: "+d((t=m(l))==null?void 0:t.total_daily_debt_sales),1)]}),_:1}),We,e(q,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Expense: "+d((t=m(l))==null?void 0:t.total_daily_expense),1)]}),_:1})])]),_:1}),e(Q,{class:"q-pt-none"},{default:a(()=>[e(I,{outlined:"",dense:"",label:"Actual Cash",modelValue:p.value,"onUpdate:modelValue":c[2]||(c[2]=t=>p.value=t),type:"number"},null,8,["modelValue"])]),_:1}),e(Q,{class:"q-pt-none"},{default:a(()=>[e(I,{outlined:"",dense:"",label:"Actual Mpesa",modelValue:y.value,"onUpdate:modelValue":c[3]||(c[3]=t=>y.value=t),type:"number"},null,8,["modelValue"])]),_:1}),s("div",Xe,[s("small",null,d(C.value),1)]),e(ne,{align:"right"},{default:a(()=>[e(k,{flat:"",label:"Cancel",color:"red",onClick:te}),e(J),p.value&&!v.value?(b(),B(k,{key:0,flat:"",label:"Close Day",color:"primary",onClick:ae,loading:f.value},null,8,["loading"])):H("",!0),p.value&&v.value?(b(),B(k,{key:1,flat:"",label:"Edit Account",color:"primary",onClick:le,loading:f.value},null,8,["loading"])):H("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{fa as default};
