import{b as Y,Q as x,a as o}from"./QList.ab5bf1c0.js";import{Q as j}from"./QSeparator.f634ffd5.js";import{Q,a as T,h as I}from"./helpers.7f2442be.js";import{r as S,j as le,aR as se,aJ as y,a4 as B,a5 as M,c1 as oe,a6 as q,a7 as s,d as e,bb as a,bD as V,ad as n,bE as $,Q as r,N as U,aM as re,aK as de,u as h}from"./index.c8a14f3d.js";import{Q as P}from"./QInput.e7fa28fe.js";import{Q as ne}from"./QBtnGroup.71c10a8e.js";import{Q as ue}from"./QTable.3b54437f.js";import{Q as K}from"./QSpace.0c24a6e8.js";import{Q as k}from"./QBadge.ed198dc0.js";import{Q as ce}from"./QToolbar.6127e444.js";import{Q as ie}from"./QCardActions.5ac4ea1f.js";import{Q as _e}from"./QDialog.705d3518.js";import{e as me,a as fe}from"./excel.5d19a2ad.js";import{u as pe}from"./use-quasar.830122b0.js";import{u as F,a as he}from"./index.e2e51196.js";import{u as xe}from"./account-store.c1b65768.js";import{u as be}from"./auth-store.e836192b.js";import{h as ve}from"./moment.9709ab41.js";import{u as ye}from"./sale-store.07791797.js";import"./use-dark.9a9c194b.js";import"./use-key-composition.86a874c5.js";import"./uid.9b787859.js";import"./rtl.5c823d43.js";import"./module_calls.101134f6.js";const R=[{name:"production_cost",required:!0,label:"Expense",align:"left",field:d=>d.production_cost,format:d=>`${d}`,sortable:!0},{name:"total_sales",required:!0,label:"Expected Sales",align:"left",field:d=>d.total_sales,format:d=>`${d}`,sortable:!0},{name:"expected_cash",align:"center",label:"Expected Cash",field:"expected_cash",sortable:!0},{name:"expected_mpesa",align:"center",label:"Expected Mpesa",field:"expected_mpesa",sortable:!0},{name:"actual_cash",align:"center",label:"Actual Cash",field:"actual_cash",sortable:!0},{name:"actual_mpesa",align:"center",label:"Actual Mpesa",field:"actual_mpesa",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0}],ge={__name:"Line",setup(d){const p=ye();F("sales",()=>p.fetchSevenDaysSales(),{onSuccess:m=>{var v,c,f,i;l.xaxis.categories=(v=m.map(_=>_.day))==null?void 0:v.reverse(),g.value[0].data=(c=m.map(_=>_.sales))==null?void 0:c.reverse(),g.value[1].data=(f=m.map(_=>_.expense))==null?void 0:f.reverse(),g.value[2].data=(i=m.map(_=>_.difference))==null?void 0:i.reverse()}});const g=S([{name:"Sales",data:[]},{name:"Expense",data:[]},{name:"Difference (Sales - Expense)",data:[]}]),l=le({chart:{height:350,type:"line",dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1}},colors:["#017951","#FF0000","#000000"],dataLabels:{enabled:!0},stroke:{curve:"smooth"},title:{text:"Sales, Expenses and Difference",align:"left"},grid:{borderColor:"#31CCEC",row:{colors:["#f3f3f3","transparent"],opacity:.5},column:{colors:["#f3f3f3","transparent"]},xaxis:{lines:{show:!0}}},markers:{size:1},xaxis:{categories:[],title:{text:"Date/Days"}},yaxis:{title:{text:"Amount"}},legend:{position:"top",horizontalAlign:"right",floating:!0,offsetY:-25,offsetX:-5}});return(m,v)=>{const c=se("apexchart");return g.value[0].data.length?(y(),B(c,{key:0,type:"line",height:"348",options:l,series:g.value},null,8,["options","series"])):M("",!0)}}};const O=d=>(re("data-v-2ff8a306"),d=d(),de(),d),we={class:"row q-col-gutter-sm q-mb-sm"},Se={class:"col-lg-3 col-md-3 col-sm-12 col-xs-12"},Ce={class:"text-center q-pa-xs"},Ae={style:{color:"#017951"}},qe={class:"desktop_stats q-pa-sm"},Ee={class:"q-pa-xs"},ke=O(()=>s("hr",null,null,-1)),Qe={class:"q-ma-sm small_text"},$e={class:"q-pa-xs"},Le=O(()=>s("hr",null,null,-1)),Ne={class:"q-ma-sm small_text"},De={class:"q-pa-xs"},Ve={key:0},Te={key:1},Be=O(()=>s("hr",null,null,-1)),Me={class:"q-ma-sm small_text"},je={class:"mobile_stats q-pa-sm"},ze={key:0},Ie={key:1},Pe={class:"col-lg-9 col-md-9 col-sm-12 col-xs-12 desktop_stats"},Ye={class:"text-center q-pa-sm"},Ue={style:{color:"#017951"}},Fe={__name:"AccountsBarCharts",props:["account_store"],setup(d){const p=g=>{if(g)return Number(g.split(",").join(""))};return(g,l)=>(y(),q("div",we,[s("div",Se,[e(Q,{flat:"",style:{"border-radius":"8px"}},{default:a(()=>{var m,v;return[s("div",Ce,[s("b",Ae,[e(V,{name:"grain"}),n(" Today")])]),e(j,{color:"primary"}),s("div",qe,[s("div",Ee,[e(Q,{dark:"",class:"shadow-2 total_grad card_border"},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var c;return[n(" Total Sales "),e($,{size:"xs",flat:"",label:"view more",to:"/sales"}),ke,s("h6",Qe,r((c=d.account_store)==null?void 0:c.total_daily_sales),1)]}),_:1})]),_:1})]),s("div",$e,[e(Q,{dark:"",class:"shadow-2 expense_grad card_border"},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var c;return[n(" Total Expense "),e($,{size:"xs",flat:"",label:"view more",to:"/inventories"}),Le,s("h6",Ne,r((c=d.account_store)==null?void 0:c.total_daily_expense),1)]}),_:1})]),_:1})]),s("div",De,[e(Q,{dark:"",class:U(`${p((m=d.account_store)==null?void 0:m.total_daily_sales)-p((v=d.account_store)==null?void 0:v.total_daily_expense)>0?"shadow-2 bg-blue card_border":"shadow-2 bg-red card_border"}`)},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var c,f,i,_;return[p((c=d.account_store)==null?void 0:c.total_daily_sales)-p((f=d.account_store)==null?void 0:f.total_daily_expense)>0?(y(),q("span",Ve," Profit ")):(y(),q("span",Te,"Loss")),Be,s("h6",Me,r((p((i=d.account_store)==null?void 0:i.total_daily_sales)-p((_=d.account_store)==null?void 0:_.total_daily_expense)).toLocaleString()),1)]}),_:1})]),_:1},8,["class"])])]),s("div",je,[e(Y,null,{default:a(()=>{var c,f;return[e(x,{dark:"",class:"q-my-sm total_grad card_border"},{default:a(()=>[e(o,{avatar:""},{default:a(()=>[e(V,{name:"blur_on"})]),_:1}),e(o,null,{default:a(()=>[n("Total")]),_:1}),e(o,{side:""},{default:a(()=>{var i;return[s("b",null,r((i=d.account_store)==null?void 0:i.total_daily_sales),1)]}),_:1})]),_:1}),e(x,{dark:"",class:"q-my-sm expense_grad card_border"},{default:a(()=>[e(o,{avatar:""},{default:a(()=>[e(V,{name:"blur_on"})]),_:1}),e(o,null,{default:a(()=>[n("Expense")]),_:1}),e(o,{side:""},{default:a(()=>{var i;return[s("b",null,r((i=d.account_store)==null?void 0:i.total_daily_expense),1)]}),_:1})]),_:1}),e(x,{dark:"",class:U(`${p((c=d.account_store)==null?void 0:c.total_daily_sales)-p((f=d.account_store)==null?void 0:f.total_daily_expense)>0?"bg-blue card_border":"bg-red card_border"}`)},{default:a(()=>[e(o,{avatar:""},{default:a(()=>[e(V,{name:"blur_on"})]),_:1}),e(o,null,{default:a(()=>{var i,_;return[p((i=d.account_store)==null?void 0:i.total_daily_sales)-p((_=d.account_store)==null?void 0:_.total_daily_expense)>0?(y(),q("span",ze," Profit ")):(y(),q("span",Ie,"Loss"))]}),_:1}),e(o,{side:""},{default:a(()=>{var i,_;return[s("b",null,r((p((i=d.account_store)==null?void 0:i.total_daily_sales)-p((_=d.account_store)==null?void 0:_.total_daily_expense)).toLocaleString()),1)]}),_:1})]),_:1},8,["class"])]}),_:1})])]}),_:1})]),s("div",Pe,[e(Q,{style:{"border-radius":"8px"}},{default:a(()=>[s("div",Ye,[s("b",Ue,[e(V,{name:"grain"}),n(" Last Seven Days")])]),e(j,{color:"primary"}),e(ge)]),_:1})])]))}};var Oe=oe(Fe,[["__scopeId","data-v-2ff8a306"]]);const Ge={class:"q-pa-md"},Je={key:0},Ke={key:1},Re=["onClick"],Xe={style:{color:"white"}},He={style:{color:"white"}},We={style:{color:"white"}},Ze=s("small",null,[s("i",null,"(Total Sales - Expenses)")],-1),ea=s("br",null,null,-1),aa=s("small",null,[s("i",null,"(Total Sales - Expense)")],-1),ta={class:"text-center q-pt-sm"},la={class:"text-h6"},sa={style:{"text-align":"center"}},oa=s("i",null,"Expected Values",-1),ra=s("hr",null,null,-1),da=s("br",null,null,-1),na=s("br",null,null,-1),ua={class:"text-center error_msg"},Va={__name:"Accounts",setup(d){const p=pe(),g=he(),l=xe(),m=be(),v=S(!1),c=S(!1),f=S(!1),i=S(""),_=S(""),w=S(0),A=S(0),z=S(""),L=S(""),{data:G,isLoading:X,isError:J}=F("accounts",()=>l.fetchAccounts());F("account_stats_today",()=>l.fetchTodaySalesStats());const H=()=>{_.value="Close Accounts for the day",v.value=!0,c.value=!1},W=b=>{var u,t;I((t=(u=m==null?void 0:m.user)==null?void 0:u.user)==null?void 0:t.roles)?(c.value=!0,_.value=`Edit Account for ${b.created_at}`,z.value=b.uuid,w.value=b.actual_cash,A.value=b.actual_mpesa,v.value=!0):alert("You are not authorized to edit the accounts. Contact admin.")},Z=async()=>{var b,u,t,N;if(f.value=!0,L.value="",I((u=(b=m==null?void 0:m.user)==null?void 0:b.user)==null?void 0:u.roles)){const D={user_departments:(N=(t=m==null?void 0:m.user)==null?void 0:t.user)==null?void 0:N.departments.map(C=>C.name),actual_cash:Number(w.value),actual_mpesa:Number(A.value),expected_cash:Number(l==null?void 0:l.total_daily_cash_sales.split(",").join("")),expected_mpesa:Number(l==null?void 0:l.total_daily_mpesa_sales.split(",").join("")),expected_mpesa_cash:Number(l==null?void 0:l.total_daily_mpesa_cash_sales.split(",").join("")),expected_card:Number(l==null?void 0:l.total_daily_card_sales.split(",").join("")),expected_debt:Number(l==null?void 0:l.total_daily_debt_sales.split(",").join("")),total_sales:Number(l==null?void 0:l.total_daily_sales.split(",").join("")),total_expense:Number(l==null?void 0:l.total_daily_expense.split(",").join(""))};if(D.actual_cash||D.actual_mpesa){const C=await l.createAccount(D);C.status==="success"?(g.refetchQueries("accounts"),w.value=1,A.value=1,v.value=!1,E(C.message,"green","top"),f.value=!1):(L.value=C.message,E(C.message,"red","top-right"),f.value=!1)}else L.value="Either actual cash or mpesa should be greater than zero!",E("Either actual cash or mpesa should be greater than zero!","red","top-right"),f.value=!1}else E("Permission denied! Only cashier or admin is allowed","red","top")},ee=async()=>{f.value=!0;const b={account_uuid:z.value,actual_cash:Number(w.value),actual_mpesa:Number(A.value),expected_cash:l==null?void 0:l.total_daily_cash_sales,expected_mpesa:l==null?void 0:l.total_daily_mpesa_sales,expected_mpesa_cash:l==null?void 0:l.total_daily_mpesa_cash_sales,expected_card:l==null?void 0:l.total_daily_card_sales,expected_debt:l==null?void 0:l.total_daily_debt_sales,total_sales:l==null?void 0:l.total_daily_sales,total_expense:l==null?void 0:l.total_daily_expense};if(b.actual_cash&&b.actual_mpesa){const u=await l.updateAccount(b);u.status==="success"?(g.refetchQueries("accounts"),w.value=1,A.value=1,v.value=!1,c.value=!1,_.value="",E(u.message,"green","top"),f.value=!1):(f.value=!1,E("There was an error","red","top-right"))}else L.value="Name is required!",E("Name is required!","red","top-right"),f.value=!1},ae=()=>{v.value=!1,w.value=1,A.value=1,z.value="",L.value=""},E=(b,u,t)=>{p.notify({message:b,color:u,position:t})},te=b=>{const u=b.map(t=>({name:t.name,users:t.users.length,created_at:t.created_at}));me(u,R,fe,p,"AccountsData")};return(b,u)=>(y(),q("div",Ge,[e(Oe,{account_store:h(l)},null,8,["account_store"]),h(X)?(y(),q("div",Je,"Loading accounts...")):h(J)?(y(),q("div",Ke,"An error has occurred: "+r(h(J)),1)):(y(),B(ue,{key:2,title:"Accounts",rows:h(G),columns:h(R),separator:"cell","row-key":"name",filter:i.value,dense:"",grid:""},{item:a(t=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 select_account",style:{cursor:"pointer"},onClick:N=>W(t.row)},[e(Q,{ripple:"",class:U(`${h(ve)().format("DD-MM-YYYY")!==t.row.valid_date?"old_account":"shadow-2"} `)},{default:a(()=>[e(T,null,{default:a(()=>[e(Y,{dense:"",separator:""},{default:a(()=>[e(x,{flat:"",class:"bg-primary text-white"},{default:a(()=>[e(o,null,{default:a(()=>[n(" Created on ")]),_:1}),e(o,{side:""},{default:a(()=>[s("span",Xe,r(t.row.created_at),1)]),_:2},1024)]),_:2},1024),e(x,{flat:"",class:"bg-blue text-white"},{default:a(()=>[e(o,null,{default:a(()=>[n(" Account closed by ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",He,r(t.row.user),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.total_sales.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.expected_cash.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.expected_mpesa.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Mpesa & Cash")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.expected_mpesa_cash.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Card")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.expected_card.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Debt")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.expected_debt.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,{class:"bg-orange text-white"},{default:a(()=>[e(o,null,{default:a(()=>[n(" Expenses ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",We,r(t.row.production_cost.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Expected Profit "),Ze]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.expected_profit.toLocaleString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(j,{color:"primary"}),n(),ea,e(j,{color:"orange"}),e(Y,{dense:"",separator:""},{default:a(()=>[e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Actual Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.actual_total_sales.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Actual Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.actual_cash.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Actual Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.actual_mpesa.toLocaleString()),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(o,null,{default:a(()=>[n(" Actual Profit "),aa]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,r(t.row.actual_profit.toLocaleString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),s("div",ta,[s("small",null,[s("i",null,"Department: "+r(t.row.department.toLocaleString()),1)])])]),_:2},1024)]),_:2},1032,["class"])],8,Re)]),"top-right":a(()=>{var t,N,D;return[e(P,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=C=>i.value=C),placeholder:"Search",class:"q-mr-md"},{append:a(()=>[e(V,{name:"search"})]),_:1},8,["modelValue"]),h(I)((D=(N=(t=h(m))==null?void 0:t.user)==null?void 0:N.user)==null?void 0:D.roles)?(y(),B(ne,{key:0},{default:a(()=>[e($,{onClick:H,round:"",dense:"",color:"primary",size:"small",icon:"add",label:"Add"}),e($,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:u[1]||(u[1]=C=>te(h(G)))})]),_:1})):M("",!0)]}),_:1},8,["rows","columns","filter"])),e(_e,{modelValue:v.value,"onUpdate:modelValue":u[4]||(u[4]=t=>v.value=t),persistent:""},{default:a(()=>[e(Q,{style:{width:"700px"}},{default:a(()=>[e(ce,null,{default:a(()=>[s("div",la,r(_.value),1),e(K),s("small",sa,[oa,ra,e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Total: "+r((t=h(l))==null?void 0:t.total_daily_sales),1)]}),_:1}),e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Cash: "+r((t=h(l))==null?void 0:t.total_daily_cash_sales),1)]}),_:1}),e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Mpesa: "+r((t=h(l))==null?void 0:t.total_daily_mpesa_sales),1)]}),_:1}),da,e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Mpesa & Cash: "+r((t=h(l))==null?void 0:t.total_daily_mpesa_cash_sales),1)]}),_:1}),e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Card: "+r((t=h(l))==null?void 0:t.total_daily_card_sales),1)]}),_:1}),e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Debt: "+r((t=h(l))==null?void 0:t.total_daily_debt_sales),1)]}),_:1}),na,e(k,{class:"q-mr-xs"},{default:a(()=>{var t;return[n("Expense: "+r((t=h(l))==null?void 0:t.total_daily_expense),1)]}),_:1})])]),_:1}),e(T,{class:"q-pt-none"},{default:a(()=>[e(P,{outlined:"",dense:"",label:"Actual Cash",modelValue:w.value,"onUpdate:modelValue":u[2]||(u[2]=t=>w.value=t),type:"number",min:"0",oninput:"validity.valid||(value='');"},null,8,["modelValue"])]),_:1}),e(T,{class:"q-pt-none"},{default:a(()=>[e(P,{outlined:"",dense:"",label:"Actual Mpesa",modelValue:A.value,"onUpdate:modelValue":u[3]||(u[3]=t=>A.value=t),type:"number",min:"0",oninput:"validity.valid||(value='');"},null,8,["modelValue"])]),_:1}),s("div",ua,[s("small",null,r(L.value),1)]),e(ie,{align:"right"},{default:a(()=>[e($,{flat:"",label:"Cancel",color:"red",onClick:ae}),e(K),w.value&&!c.value?(y(),B($,{key:0,flat:"",label:"Close Day",color:"primary",onClick:Z,loading:f.value},null,8,["loading"])):M("",!0),w.value&&c.value?(y(),B($,{key:1,flat:"",label:"Edit Account",color:"primary",onClick:ee,loading:f.value},null,8,["loading"])):M("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Va as default};
