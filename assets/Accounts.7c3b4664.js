import{p as G,n as _,o}from"./rtl.26771cb4.js";import{Q as P}from"./QSeparator.6d4bfee8.js";import{a as E,Q}from"./QCard.1055709c.js";import{j as de,r as x,aI as v,a5 as $,a6 as s,d as e,bb as a,bD as Y,ac as u,P as d,M as ue,u as i,a3 as U,b as ne,bE as k,a4 as H}from"./index.f65f6c89.js";import{Q as I}from"./QInput.22d83a86.js";import{Q as ce,c as re,p as ie,d as J,f as _e}from"./paginations.702d832b.js";import{a as me,Q as A}from"./QBadge.a8badd9e.js";import{e as fe,a as pe}from"./excel.5d19a2ad.js";import{a as he}from"./use-quasar.50b510cc.js";import{a as xe,u as K}from"./index.ec001523.js";import{u as be}from"./account-store.78e003aa.js";import{u as ve}from"./auth-store.23313cc2.js";import{g as W}from"./get-css-var.23548d6a.js";import"./use-dark.78627c36.js";import"./module_calls.c637478d.js";import"./helpers.d60dad50.js";const X=[{name:"production_cost",required:!0,label:"Expense",align:"left",field:c=>c.production_cost,format:c=>`${c}`,sortable:!0},{name:"total_sales",required:!0,label:"Expected Sales",align:"left",field:c=>c.total_sales,format:c=>`${c}`,sortable:!0},{name:"expected_cash",align:"center",label:"Expected Cash",field:"expected_cash",sortable:!0},{name:"expected_mpesa",align:"center",label:"Expected Mpesa",field:"expected_mpesa",sortable:!0},{name:"actual_cash",align:"center",label:"Actual Cash",field:"actual_cash",sortable:!0},{name:"actual_mpesa",align:"center",label:"Actual Mpesa",field:"actual_mpesa",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0}],ye={class:"row q-col-gutter-sm q-ml-xs q-mr-sm q-py-sm"},ge={class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},we={class:"text-center q-pa-sm"},qe={style:{color:"#017951"}},Ae={class:"row q-pa-sm"},Ce={class:"q-pa-xs col-xs-12 col-sm-4 col-md-4"},Ee=s("hr",null,null,-1),Qe={class:"q-ma-sm"},$e={class:"q-pa-xs col-xs-12 col-sm-4 col-md-4"},ke=s("hr",null,null,-1),Se={class:"q-ma-sm"},Ve={class:"q-pa-xs col-xs-12 col-sm-4 col-md-4"},Ne={key:0},Te={key:1},De=s("hr",null,null,-1),Me={class:"q-ma-sm"},Be={__name:"AccountsBarCharts",props:["account_store"],setup(c){return de({title:{text:"Sales vs Expense",align:"left"},chart:{id:"apex-donut"},colors:[W("primary"),W("dark")],markers:{size:5,hover:{sizeOffset:2}},xaxis:{categories:["Sales","Expenses"]}}),x([]),(N,T)=>(v(),$("div",ye,[s("div",ge,[e(E,null,{default:a(()=>{var l,b;return[s("div",we,[s("b",qe,[e(Y,{name:"grain"}),u(" Today")])]),e(P,{color:"primary"}),s("div",Ae,[s("div",Ce,[e(E,{dark:"",class:"bg-primary"},{default:a(()=>[e(Q,{class:"text-center"},{default:a(()=>{var f;return[u(" Total Sales "),Ee,s("h5",Qe,d((f=c.account_store)==null?void 0:f.total_daily_sales),1)]}),_:1})]),_:1})]),s("div",$e,[e(E,{dark:"",class:"bg-orange"},{default:a(()=>[e(Q,{class:"text-center"},{default:a(()=>{var f;return[u(" Total Expense "),ke,s("h5",Se,d((f=c.account_store)==null?void 0:f.total_daily_expense),1)]}),_:1})]),_:1})]),s("div",Ve,[e(E,{dark:"",class:ue(`${c.account_store&&((l=c.account_store)==null?void 0:l.total_daily_sales)-((b=c.account_store)==null?void 0:b.total_daily_expense)>0?"bg-blue":"bg-red"}`)},{default:a(()=>[e(Q,{class:"text-center"},{default:a(()=>{var f,p,y,m;return[c.account_store&&((f=c.account_store)==null?void 0:f.total_daily_sales)-((p=c.account_store)==null?void 0:p.total_daily_expense)>0?(v(),$("span",Ne," Profit ")):(v(),$("span",Te,"Loss")),De,s("h5",Me,d(((y=c.account_store)==null?void 0:y.total_daily_sales)-((m=c.account_store)==null?void 0:m.total_daily_expense)),1)]}),_:1})]),_:1},8,["class"])])])]}),_:1})])]))}};const Ue={class:"q-pa-md"},Ie={key:0},Pe={key:1},ze=["onClick"],Le={style:{color:"white"}},Oe={style:{color:"white"}},je={style:{color:"white"}},Fe=s("small",null,[s("i",null,"(Total Sales - Expenses)")],-1),Re=s("br",null,null,-1),Ge=s("small",null,[s("i",null,"(Total Sales - Expense)")],-1),He={class:"text-center q-pt-sm"},Je={class:"text-h6"},Ke={style:{"text-align":"center"}},We=s("i",null,"Expected Values",-1),Xe=s("hr",null,null,-1),Ye=s("br",null,null,-1),Ze=s("br",null,null,-1),ea={class:"text-center error_msg"},xa={__name:"Accounts",setup(c){const N=he(),T=xe(),l=be(),b=ve(),f=ie(10),p=x(!1),y=x(!1),m=x(!1),D=x(""),S=x(""),h=x(1),g=x(1),M=x(""),C=x(""),{data:z,isLoading:Z,isError:L}=K("accounts",()=>l.fetchAccounts());K("account_stats_today",()=>l.fetchTodaySalesStats());const ee=()=>{S.value="Close Accounts for the day",p.value=!0,y.value=!1},ae=r=>{y.value=!0,S.value=`Edit Account for ${r.created_at}`,M.value=r.uuid,h.value=r.actual_cash,g.value=r.actual_mpesa,p.value=!0},le=async()=>{var t,B,O,j,F,R;m.value=!0,C.value="";const r=[];(O=(B=(t=b==null?void 0:b.user)==null?void 0:t.user)==null?void 0:B.departments)==null||O.forEach(q=>r.push(q.name));const n=[];if((R=(F=(j=b==null?void 0:b.user)==null?void 0:j.user)==null?void 0:F.roles)==null||R.forEach(q=>n.push(q.name)),n.includes("Admin")||n.includes("Cashier")){const q={user_departments:r,actual_cash:Number(h.value),actual_mpesa:Number(g.value),expected_cash:l==null?void 0:l.total_daily_cash_sales,expected_mpesa:l==null?void 0:l.total_daily_mpesa_sales,expected_mpesa_cash:l==null?void 0:l.total_daily_mpesa_cash_sales,expected_card:l==null?void 0:l.total_daily_card_sales,expected_debt:l==null?void 0:l.total_daily_debt_sales,total_sales:l==null?void 0:l.total_daily_sales,total_expense:l==null?void 0:l.total_daily_expense};if(q.actual_cash&&q.actual_mpesa){const V=await l.createAccount(q);V.status==="success"?(T.refetchQueries("accounts"),h.value=1,g.value=1,p.value=!1,w(V.message,"green","top"),m.value=!1):(C.value=V.message,w(V.message,"red","top-right"),m.value=!1)}else C.value="Name is required!",w("Name is required!","red","top-right"),m.value=!1}else w("Permission denied! Only cashier or admin is allowed","red","top")},te=async()=>{m.value=!0;const r={account_uuid:M.value,actual_cash:Number(h.value),actual_mpesa:Number(g.value),expected_cash:l==null?void 0:l.total_daily_cash_sales,expected_mpesa:l==null?void 0:l.total_daily_mpesa_sales,expected_mpesa_cash:l==null?void 0:l.total_daily_mpesa_cash_sales,expected_card:l==null?void 0:l.total_daily_card_sales,expected_debt:l==null?void 0:l.total_daily_debt_sales,total_sales:l==null?void 0:l.total_daily_sales,total_expense:l==null?void 0:l.total_daily_expense};if(r.actual_cash&&r.actual_mpesa){const n=await l.updateAccount(r);n.status==="success"?(T.refetchQueries("accounts"),h.value=1,g.value=1,p.value=!1,y.value=!1,S.value="",w(n.message,"green","top"),m.value=!1):(m.value=!1,w("There was an error","red","top-right"))}else C.value="Name is required!",w("Name is required!","red","top-right"),m.value=!1},se=()=>{p.value=!1,h.value=1,g.value=1,M.value="",C.value=""},w=(r,n,t)=>{N.notify({message:r,color:n,position:t})},oe=r=>{const n=r.map(t=>({name:t.name,users:t.users.length,created_at:t.created_at}));fe(n,X,pe,N,"AccountsData")};return(r,n)=>(v(),$("div",Ue,[e(Be,{account_store:i(l)},null,8,["account_store"]),i(Z)?(v(),$("div",Ie,"Loading accounts...")):i(L)?(v(),$("div",Pe,"An error has occurred: "+d(i(L)),1)):(v(),U(ce,{key:2,title:"Accounts",rows:i(z),columns:i(X),pagination:i(f),"onUpdate:pagination":n[2]||(n[2]=t=>ne(f)?f.value=t:null),separator:"cell","row-key":"name",filter:D.value,dense:"",grid:""},{item:a(t=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 select_account",style:{cursor:"pointer"},onClick:B=>ae(t.row)},[e(E,{bordered:"",ripple:"",style:{border:"1px solid orange"}},{default:a(()=>[e(Q,null,{default:a(()=>[e(G,{dense:"",bordered:"",separator:""},{default:a(()=>[e(_,{class:"bg-primary text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Accounts closed on ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",Le,d(t.row.created_at),1)]),_:2},1024)]),_:2},1024),e(_,{class:"bg-blue text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Accounts closed by ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",Oe,d(t.row.user),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.total_sales),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_cash),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_mpesa),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Mpesa $ Cash")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_mpesa_cash),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Card")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_card),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Debt")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_debt),1)]),_:2},1024)]),_:2},1024),e(_,{class:"bg-orange text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Expenses ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",je,d(t.row.production_cost),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Profit "),Fe]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.expected_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(P,{color:"primary"}),u(),Re,e(P,{color:"orange"}),e(G,{dense:"",bordered:"",separator:""},{default:a(()=>[e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_total_sales),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_cash),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_mpesa),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Profit "),Ge]),_:1}),e(o,{side:""},{default:a(()=>[s("b",null,d(t.row.actual_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),s("div",He,[s("small",null,[s("i",null,"Department: "+d(t.row.department),1)])])]),_:2},1024)]),_:2},1024)],8,ze)]),"top-right":a(()=>[e(I,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":n[0]||(n[0]=t=>D.value=t),placeholder:"Search",class:"q-mr-md"},{append:a(()=>[e(Y,{name:"search"})]),_:1},8,["modelValue"]),e(k,{onClick:ee,round:"",dense:"",color:"primary",size:"small",icon:"add"}),e(k,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:n[1]||(n[1]=t=>oe(i(z)))})]),_:1},8,["rows","columns","pagination","filter"])),e(re,{modelValue:p.value,"onUpdate:modelValue":n[5]||(n[5]=t=>p.value=t),persistent:""},{default:a(()=>[e(E,{style:{width:"700px"}},{default:a(()=>[e(me,null,{default:a(()=>[s("div",Je,d(S.value),1),e(J),s("small",Ke,[We,Xe,e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Total: "+d((t=i(l))==null?void 0:t.total_daily_sales),1)]}),_:1}),e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Cash: "+d((t=i(l))==null?void 0:t.total_daily_cash_sales),1)]}),_:1}),e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Mpesa: "+d((t=i(l))==null?void 0:t.total_daily_mpesa_sales),1)]}),_:1}),Ye,e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Mpesa & Cash: "+d((t=i(l))==null?void 0:t.total_daily_mpesa_cash_sales),1)]}),_:1}),e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Card: "+d((t=i(l))==null?void 0:t.total_daily_card_sales),1)]}),_:1}),e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Debt: "+d((t=i(l))==null?void 0:t.total_daily_debt_sales),1)]}),_:1}),Ze,e(A,{class:"q-mr-xs"},{default:a(()=>{var t;return[u("Expense: "+d((t=i(l))==null?void 0:t.total_daily_expense),1)]}),_:1})])]),_:1}),e(Q,{class:"q-pt-none"},{default:a(()=>[e(I,{outlined:"",dense:"",label:"Actual Cash",modelValue:h.value,"onUpdate:modelValue":n[3]||(n[3]=t=>h.value=t),type:"number"},null,8,["modelValue"])]),_:1}),e(Q,{class:"q-pt-none"},{default:a(()=>[e(I,{outlined:"",dense:"",label:"Actual Mpesa",modelValue:g.value,"onUpdate:modelValue":n[4]||(n[4]=t=>g.value=t),type:"number"},null,8,["modelValue"])]),_:1}),s("div",ea,[s("small",null,d(C.value),1)]),e(_e,{align:"right"},{default:a(()=>[e(k,{flat:"",label:"Cancel",color:"red",onClick:se}),e(J),h.value&&!y.value?(v(),U(k,{key:0,flat:"",label:"Close Day",color:"primary",onClick:le,loading:m.value},null,8,["loading"])):H("",!0),h.value&&y.value?(v(),U(k,{key:1,flat:"",label:"Edit Account",color:"primary",onClick:te,loading:m.value},null,8,["loading"])):H("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{xa as default};
