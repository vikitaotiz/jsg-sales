import{p as X,n as h,o as n}from"./rtl.e3274486.js";import{Q as Y}from"./QSeparator.00910b71.js";import{a as $,Q as T}from"./QCard.287aa4cb.js";import{j as ne,r as C,aQ as ce,aI as E,a5 as D,a6 as s,d as e,bb as a,ac as u,P as c,u as l,M as Z,a3 as F,b as ue,bD as re,bE as P,a4 as ee}from"./index.43b29598.js";import{Q as j}from"./QInput.50502b6a.js";import{Q as de,c as ie,p as _e,d as ae,f as me}from"./paginations.d31396ff.js";import{a as pe,Q as R}from"./QBadge.c37ec33e.js";import{e as fe,a as he}from"./excel.5d19a2ad.js";import{a as ve}from"./use-quasar.811db318.js";import{u as G,a as xe}from"./index.fe5141b8.js";import{u as le}from"./account-store.6f4ffac4.js";import{u as be}from"./auth-store.06637eb3.js";import{g as te}from"./get-css-var.23548d6a.js";import{u as ge}from"./inventory-store.b30b785a.js";import"./use-dark.ad1ce312.js";import"./module_calls.e16012c0.js";import"./helpers.01ee3f07.js";const se=[{name:"production_cost",required:!0,label:"Expense",align:"left",field:y=>y.production_cost,format:y=>`${y}`,sortable:!0},{name:"total_sales",required:!0,label:"Expected Sales",align:"left",field:y=>y.total_sales,format:y=>`${y}`,sortable:!0},{name:"expected_cash",align:"center",label:"Expected Cash",field:"expected_cash",sortable:!0},{name:"expected_mpesa",align:"center",label:"Expected Mpesa",field:"expected_mpesa",sortable:!0},{name:"actual_cash",align:"center",label:"Actual Cash",field:"actual_cash",sortable:!0},{name:"actual_mpesa",align:"center",label:"Actual Mpesa",field:"actual_mpesa",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0}],ye={class:"row q-col-gutter-sm q-ml-xs q-mr-sm q-py-sm"},Ae={class:"col-lg-6 col-md-6 col-sm-12 col-xs-12"},qe={class:"row q-pa-sm"},we={class:"q-pa-xs col-xs-12 col-sm-6 col-md-6"},Ce=s("hr",null,null,-1),Ee={class:"q-ma-sm"},Qe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-6"},$e=s("hr",null,null,-1),ke={class:"q-ma-sm"},Se={class:"q-pa-xs col-xs-12 col-sm-6 col-md-6"},Ve={key:0},Te={key:1},Ne=s("hr",null,null,-1),De={class:"q-ma-sm"},Be={class:"q-pa-xs col-xs-12 col-sm-6 col-md-6"},Me=s("span",null," Percentage ",-1),Pe=s("hr",null,null,-1),Ie={class:"q-ma-sm"},Ue={class:"col-lg-6 col-md-6 col-sm-12 col-xs-12"},ze={__name:"AccountsBarCharts",setup(y){const v=le(),m=ge(),r=d=>{let x=0;return d&&d.forEach(q=>x+=q.quantity*q.buying_price),x},Q=(d,x)=>d?((d-x)/x*100).toFixed(2):0,B=ne({title:{text:"Sales vs Expense",align:"left"},chart:{id:"apex-donut"},colors:[te("primary"),te("dark")],markers:{size:5,hover:{sizeOffset:2}},xaxis:{categories:["Sales","Expenses"]}}),A=C([]);return G("accounts",()=>v.fetchAccountStats(),{onSuccess:d=>{console.log(d)}}),(d,x)=>{const q=ce("apexchart");return E(),D("div",ye,[s("div",Ae,[e($,null,{default:a(()=>{var p,b,N,w,M,I;return[s("div",qe,[s("div",we,[e($,{dark:"",class:"bg-primary"},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var i,g;return[u(" Total Sales "),Ce,s("h5",Ee,c((g=(i=l(v))==null?void 0:i.today_sales_data[0])==null?void 0:g.total_daily_sales),1)]}),_:1})]),_:1})]),s("div",Qe,[e($,{dark:"",class:"bg-orange"},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var i;return[u(" Total Expense "),$e,s("h5",ke,c(r((i=l(m))==null?void 0:i.inventories)),1)]}),_:1})]),_:1})]),s("div",Se,[e($,{dark:"",class:Z(`${l(m)&&((b=(p=l(v))==null?void 0:p.today_sales_data[0])==null?void 0:b.total_daily_sales)-r((N=l(m))==null?void 0:N.inventories)>0?"bg-blue":"bg-red"}`)},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var i,g,k,U,z,L;return[l(m)&&((g=(i=l(v))==null?void 0:i.today_sales_data[0])==null?void 0:g.total_daily_sales)-r((k=l(m))==null?void 0:k.inventories)>0?(E(),D("span",Ve," Profit ")):(E(),D("span",Te,"Loss")),Ne,s("h5",De,c(((z=(U=l(v))==null?void 0:U.today_sales_data[0])==null?void 0:z.total_daily_sales)-r((L=l(m))==null?void 0:L.inventories))+" ",1)]}),_:1})]),_:1},8,["class"])]),s("div",Be,[e($,{dark:"",class:Z(`${l(m)&&((M=(w=l(v))==null?void 0:w.today_sales_data[0])==null?void 0:M.total_daily_sales)-r((I=l(m))==null?void 0:I.inventories)>0?"bg-blue":"bg-red"}`)},{default:a(()=>[e(T,{class:"text-center"},{default:a(()=>{var i,g,k;return[Me,Pe,s("h5",Ie,c(Q((g=(i=l(v))==null?void 0:i.today_sales_data[0])==null?void 0:g.total_daily_sales,r((k=l(m))==null?void 0:k.inventories)))+" % ",1)]}),_:1})]),_:1},8,["class"])])])]}),_:1})]),s("div",Ue,[e($,{class:"q-mb-sm"},{default:a(()=>[e(q,{height:"250",type:"donut",options:B,series:A.value},null,8,["options","series"])]),_:1})])])}}};const Le={class:"q-pa-md"},Oe={key:0},Fe={key:1},je=["onClick"],Re={style:{color:"white"}},Ge={style:{color:"white"}},He={style:{color:"white"}},Je=s("small",null,[s("i",null,"(Total Sales - Expenses)")],-1),Ke=s("br",null,null,-1),We=s("small",null,[s("i",null,"(Total Sales - Expense)")],-1),Xe={class:"text-center q-pt-sm"},Ye={class:"text-h6"},Ze={style:{"text-align":"center"}},ea=s("i",null,"Expected Values",-1),aa=s("hr",null,null,-1),ta={class:"text-center error_msg"},ga={__name:"Accounts",setup(y){const v=ve(),m=xe(),r=le(),Q=be(),B=_e(10),A=C(!1),d=C(!1),x=C(""),q=C(""),p=C(1),b=C(1),N=C(""),w=C(""),{data:M,isLoading:I,isError:i}=G("accounts",()=>r.fetchAccounts());G("account_stats_today",()=>r.fetchTodaySalesStats());const g=()=>{q.value="Close Accounts for the day",A.value=!0,d.value=!1},k=_=>{d.value=!0,q.value=`Edit Account ${_.created_at}`,N.value=_.uuid,A.value=!0},U=async()=>{var t,f,H,J,K,W;w.value="";const _=[];(H=(f=(t=Q==null?void 0:Q.user)==null?void 0:t.user)==null?void 0:f.departments)==null||H.forEach(V=>_.push(V.name));const o=[];if((W=(K=(J=Q==null?void 0:Q.user)==null?void 0:J.user)==null?void 0:K.roles)==null||W.forEach(V=>o.push(V.name)),o.includes("Admin")||o.includes("Cashier")){const V={actual_cash:Number(p.value),actual_mpesa:Number(b.value),user_departments:_};if(V.actual_cash&&V.actual_mpesa){const O=await r.createAccount(V);O.status==="success"?(m.refetchQueries("accounts"),p.value="",b.value="",A.value=!1,S(O.message,"green","top")):(w.value=O.message,S(O.message,"red","top-right"))}else w.value="Name is required!",S("Name is required!","red","top-right")}else S("Permission denied! Only cashier or admin is allowed","red","top")},z=async()=>{const _={account_uuid:N.value,actual_cash:p.value,actual_mpesa:b.value};if(_.actual_cash&&_.actual_mpesa){const o=await r.updateAccount(_);o.status==="success"?(m.refetchQueries("accounts"),p.value=1,b.value=1,A.value=!1,d.value=!1,q.value="",S(o.message,"green","top")):S("There was an error","red","top-right")}else w.value="Name is required!",S("Name is required!","red","top-right")},L=()=>{A.value=!1,p.value=1,b.value=1,N.value="",w.value=""},S=(_,o,t)=>{v.notify({message:_,color:o,position:t})},oe=_=>{const o=_.map(t=>({name:t.name,users:t.users.length,created_at:t.created_at}));fe(o,se,he,v,"AccountsData")};return(_,o)=>(E(),D("div",Le,[e(ze),l(I)?(E(),D("div",Oe,"Loading accounts...")):l(i)?(E(),D("div",Fe,"An error has occurred: "+c(l(i)),1)):(E(),F(de,{key:2,title:"Accounts",rows:l(M),columns:l(se),pagination:l(B),"onUpdate:pagination":o[2]||(o[2]=t=>ue(B)?B.value=t:null),separator:"cell","row-key":"name",filter:x.value,dense:"",grid:""},{item:a(t=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 select_account",style:{cursor:"pointer"},onClick:f=>k(t.row)},[e($,{bordered:"",style:{border:"1px solid orange"}},{default:a(()=>[e(T,null,{default:a(()=>[e(X,{dense:"",bordered:"",separator:""},{default:a(()=>[e(h,{class:"bg-primary text-white"},{default:a(()=>[e(n,null,{default:a(()=>[u(" Accounts closed on ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",Re,c(t.row.created_at),1)]),_:2},1024)]),_:2},1024),e(h,{class:"bg-blue text-white"},{default:a(()=>[e(n,null,{default:a(()=>[u(" Accounts closed by ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",Ge,c(t.row.user),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Expected Total Sales ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.total_sales),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Expected Cash ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.expected_cash),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Expected Mpesa ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.expected_mpesa),1)]),_:2},1024)]),_:2},1024),e(h,{class:"bg-orange text-white"},{default:a(()=>[e(n,null,{default:a(()=>[u(" Expenses ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",He,c(t.row.production_cost),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Expected Profit "),Je]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.expected_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(Y,{color:"primary"}),u(),Ke,e(Y,{color:"orange"}),e(X,{dense:"",bordered:"",separator:""},{default:a(()=>[e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Actual Total Sales ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.actual_total_sales),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Actual Cash ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.actual_cash),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Actual Mpesa ")]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.actual_mpesa),1)]),_:2},1024)]),_:2},1024),e(h,null,{default:a(()=>[e(n,null,{default:a(()=>[u(" Actual Profit "),We]),_:1}),e(n,{side:""},{default:a(()=>[s("b",null,c(t.row.actual_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),s("div",Xe,[s("small",null,[s("i",null,"Department: "+c(t.row.department),1)])])]),_:2},1024)]),_:2},1024)],8,je)]),"top-right":a(()=>[e(j,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:x.value,"onUpdate:modelValue":o[0]||(o[0]=t=>x.value=t),placeholder:"Search",class:"q-mr-md"},{append:a(()=>[e(re,{name:"search"})]),_:1},8,["modelValue"]),e(P,{onClick:g,round:"",dense:"",color:"primary",size:"small",icon:"add"}),e(P,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:o[1]||(o[1]=t=>oe(l(M)))})]),_:1},8,["rows","columns","pagination","filter"])),e(ie,{modelValue:A.value,"onUpdate:modelValue":o[5]||(o[5]=t=>A.value=t),persistent:""},{default:a(()=>[e($,{style:{width:"700px"}},{default:a(()=>[e(pe,null,{default:a(()=>[s("div",Ye,c(q.value),1),e(ae),s("small",Ze,[ea,aa,e(R,{class:"q-mr-xs"},{default:a(()=>{var t,f;return[u("Total: "+c((f=(t=l(r))==null?void 0:t.today_sales_data[0])==null?void 0:f.total_daily_sales),1)]}),_:1}),e(R,{class:"q-mr-xs"},{default:a(()=>{var t,f;return[u("Cash: "+c((f=(t=l(r))==null?void 0:t.today_sales_data[1])==null?void 0:f.total_daily_cash_sales),1)]}),_:1}),e(R,{class:"q-mr-xs"},{default:a(()=>{var t,f;return[u("Mpesa: "+c((f=(t=l(r))==null?void 0:t.today_sales_data[2])==null?void 0:f.total_daily_mpesa_sales),1)]}),_:1})])]),_:1}),e(T,{class:"q-pt-none"},{default:a(()=>[e(j,{outlined:"",dense:"",label:"Actual Cash",modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=t=>p.value=t),type:"number"},null,8,["modelValue"])]),_:1}),e(T,{class:"q-pt-none"},{default:a(()=>[e(j,{outlined:"",dense:"",label:"Actual Mpesa",modelValue:b.value,"onUpdate:modelValue":o[4]||(o[4]=t=>b.value=t),type:"number"},null,8,["modelValue"])]),_:1}),s("div",ta,[s("small",null,c(w.value),1)]),e(me,{align:"right"},{default:a(()=>[e(P,{flat:"",label:"Cancel",color:"red",onClick:L}),e(ae),p.value&&!d.value?(E(),F(P,{key:0,flat:"",label:"Close Day",color:"primary",onClick:U})):ee("",!0),p.value&&d.value?(E(),F(P,{key:1,flat:"",label:"Edit Account",color:"primary",onClick:z})):ee("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ga as default};
