import{p as H,n as b,o}from"./rtl.74f3c00c.js";import{Q as J}from"./QSeparator.3296268e.js";import{a as S,Q as V}from"./QCard.b1d1b493.js";import{j as oe,r as w,aI as C,a5 as N,d as e,bb as a,a6 as l,ac as u,P as n,u as c,M as K,a3 as U,b as ne,bD as ce,bE as B,a4 as W}from"./index.544437db.js";import{Q as z}from"./QInput.b3c42e3c.js";import{Q as ue,a as re,p as de,d as X,c as ie}from"./paginations.dead60bc.js";import{Q as L}from"./QBadge.c9e4b02c.js";import{Q as _e}from"./QToolbar.cf5fbc2b.js";import{e as me,a as fe}from"./excel.5d19a2ad.js";import{a as pe}from"./use-quasar.eb6615ed.js";import{u as O,a as he}from"./index.a8c0ae15.js";import{u as ve}from"./account-store.58bf9e1f.js";import{u as be}from"./auth-store.fd2de9a4.js";import{g as Y}from"./get-css-var.23548d6a.js";import{u as xe}from"./inventory-store.1af8396e.js";import"./use-dark.7de2cac8.js";import"./module_calls.e16012c0.js";import"./helpers.01ee3f07.js";const Z=[{name:"production_cost",required:!0,label:"Expense",align:"left",field:r=>r.production_cost,format:r=>`${r}`,sortable:!0},{name:"total_sales",required:!0,label:"Expected Sales",align:"left",field:r=>r.total_sales,format:r=>`${r}`,sortable:!0},{name:"expected_cash",align:"center",label:"Expected Cash",field:"expected_cash",sortable:!0},{name:"expected_mpesa",align:"center",label:"Expected Mpesa",field:"expected_mpesa",sortable:!0},{name:"actual_cash",align:"center",label:"Actual Cash",field:"actual_cash",sortable:!0},{name:"actual_mpesa",align:"center",label:"Actual Mpesa",field:"actual_mpesa",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0}],ye={class:"row q-pa-sm"},ge={class:"q-pa-xs col-xs-12 col-sm-6 col-md-3"},Ae=l("hr",null,null,-1),we={class:"q-ma-sm"},Ce={class:"q-pa-xs col-xs-12 col-sm-6 col-md-3"},Ee=l("hr",null,null,-1),qe={class:"q-ma-sm"},Qe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-3"},$e={key:0},ke={key:1},Se=l("hr",null,null,-1),Ve={class:"q-ma-sm"},Te={class:"q-pa-xs col-xs-12 col-sm-6 col-md-3"},Ne=l("span",null," Percentage ",-1),De=l("hr",null,null,-1),Be={class:"q-ma-sm"},Me={__name:"AccountsBarCharts",props:["account_store"],setup(r){const f=xe();O("inventories",()=>f.fetchInventories(),{onSuccess:d=>{console.log(d)}});const A=d=>{let y=0;return d&&d.forEach(p=>y+=p.quantity*p.buying_price),y},x=(d,y)=>d?((d-y)/y*100).toFixed(2):0;return oe({title:{text:"Sales vs Expense",align:"left"},chart:{id:"apex-donut"},colors:[Y("primary"),Y("dark")],markers:{size:5,hover:{sizeOffset:2}},xaxis:{categories:["Sales","Expenses"]}}),w([60,40]),(d,y)=>(C(),N("div",null,[e(S,null,{default:a(()=>{var p,E,T,Q,h,g;return[l("div",ye,[l("div",ge,[e(S,{dark:"",class:"bg-primary"},{default:a(()=>[e(V,{class:"text-center"},{default:a(()=>{var i,_;return[u(" Total Sales "),Ae,l("h5",we,n((_=(i=r.account_store)==null?void 0:i.today_sales_data[0])==null?void 0:_.total_daily_sales),1)]}),_:1})]),_:1})]),l("div",Ce,[e(S,{dark:"",class:"bg-orange"},{default:a(()=>[e(V,{class:"text-center"},{default:a(()=>{var i;return[u(" Total Expense "),Ee,l("h5",qe,n(A((i=c(f))==null?void 0:i.inventories)),1)]}),_:1})]),_:1})]),l("div",Qe,[e(S,{dark:"",class:K(`${c(f)&&((E=(p=r.account_store)==null?void 0:p.today_sales_data[0])==null?void 0:E.total_daily_sales)-A((T=c(f))==null?void 0:T.inventories)>0?"bg-blue":"bg-red"}`)},{default:a(()=>[e(V,{class:"text-center"},{default:a(()=>{var i,_,q,M,D,I;return[c(f)&&((_=(i=r.account_store)==null?void 0:i.today_sales_data[0])==null?void 0:_.total_daily_sales)-A((q=c(f))==null?void 0:q.inventories)>0?(C(),N("span",$e," Profit ")):(C(),N("span",ke,"Loss")),Se,l("h5",Ve,n(((D=(M=r.account_store)==null?void 0:M.today_sales_data[0])==null?void 0:D.total_daily_sales)-A((I=c(f))==null?void 0:I.inventories)),1)]}),_:1})]),_:1},8,["class"])]),l("div",Te,[e(S,{dark:"",class:K(`${c(f)&&((h=(Q=r.account_store)==null?void 0:Q.today_sales_data[0])==null?void 0:h.total_daily_sales)-A((g=c(f))==null?void 0:g.inventories)>0?"bg-blue":"bg-red"}`)},{default:a(()=>[e(V,{class:"text-center"},{default:a(()=>{var i,_,q;return[Ne,De,l("h5",Be,n(x((_=(i=r.account_store)==null?void 0:i.today_sales_data[0])==null?void 0:_.total_daily_sales,A((q=c(f))==null?void 0:q.inventories)))+" % ",1)]}),_:1})]),_:1},8,["class"])])])]}),_:1})]))}};const Ie={class:"q-pa-md"},Pe={key:0},Ue={key:1},ze=["onClick"],Le={style:{color:"white"}},Oe={style:{color:"white"}},Fe={style:{color:"white"}},je=l("small",null,[l("i",null,"(Total Sales - Expenses)")],-1),Re=l("br",null,null,-1),Ge=l("small",null,[l("i",null,"(Total Sales - Expense)")],-1),He={class:"text-center q-pt-sm"},Je={class:"text-h6"},Ke={style:{"text-align":"center"}},We=l("i",null,"Expected Values",-1),Xe=l("hr",null,null,-1),Ye={class:"text-center error_msg"},va={__name:"Accounts",setup(r){const f=pe(),A=he(),x=ve(),d=be(),y=de(10),p=w(!1),E=w(!1),T=w(""),Q=w(""),h=w(1),g=w(1),i=w(""),_=w(""),{data:q,isLoading:M,isError:D}=O("accounts",()=>x.fetchAccounts());O("account_stats_today",()=>x.fetchTodaySalesStats());const I=()=>{Q.value="Close Accounts for the day",p.value=!0,E.value=!1},ee=m=>{E.value=!0,Q.value=`Edit Account ${m.created_at}`,i.value=m.uuid,p.value=!0},ae=async()=>{var t,v,F,j,R,G;_.value="";const m=[];(F=(v=(t=d==null?void 0:d.user)==null?void 0:t.user)==null?void 0:v.departments)==null||F.forEach(k=>m.push(k.name));const s=[];if((G=(R=(j=d==null?void 0:d.user)==null?void 0:j.user)==null?void 0:R.roles)==null||G.forEach(k=>s.push(k.name)),s.includes("Admin")||s.includes("Cashier")){const k={actual_cash:Number(h.value),actual_mpesa:Number(g.value),user_departments:m};if(k.actual_cash&&k.actual_mpesa){const P=await x.createAccount(k);P.status==="success"?(A.refetchQueries("accounts"),h.value="",g.value="",p.value=!1,$(P.message,"green","top")):(_.value=P.message,$(P.message,"red","top-right"))}else _.value="Name is required!",$("Name is required!","red","top-right")}else $("Permission denied! Only cashier or admin is allowed","red","top")},te=async()=>{const m={account_uuid:i.value,actual_cash:h.value,actual_mpesa:g.value};if(m.actual_cash&&m.actual_mpesa){const s=await x.updateAccount(m);s.status==="success"?(A.refetchQueries("accounts"),h.value=1,g.value=1,p.value=!1,E.value=!1,Q.value="",$(s.message,"green","top")):$("There was an error","red","top-right")}else _.value="Name is required!",$("Name is required!","red","top-right")},le=()=>{p.value=!1,h.value=1,g.value=1,i.value="",_.value=""},$=(m,s,t)=>{f.notify({message:m,color:s,position:t})},se=m=>{const s=m.map(t=>({name:t.name,users:t.users.length,created_at:t.created_at}));me(s,Z,fe,f,"AccountsData")};return(m,s)=>(C(),N("div",Ie,[e(Me,{account_store:c(x)},null,8,["account_store"]),c(M)?(C(),N("div",Pe,"Loading accounts...")):c(D)?(C(),N("div",Ue,"An error has occurred: "+n(c(D)),1)):(C(),U(ue,{key:2,title:"Accounts",rows:c(q),columns:c(Z),pagination:c(y),"onUpdate:pagination":s[2]||(s[2]=t=>ne(y)?y.value=t:null),separator:"cell","row-key":"name",filter:T.value,dense:"",grid:""},{item:a(t=>[l("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 select_account",style:{cursor:"pointer"},onClick:v=>ee(t.row)},[e(S,{bordered:"",style:{border:"1px solid orange"}},{default:a(()=>[e(V,null,{default:a(()=>[e(H,{dense:"",bordered:"",separator:""},{default:a(()=>[e(b,{class:"bg-primary text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Accounts closed on ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",Le,n(t.row.created_at),1)]),_:2},1024)]),_:2},1024),e(b,{class:"bg-blue text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Accounts closed by ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",Oe,n(t.row.user),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.total_sales),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.expected_cash),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.expected_mpesa),1)]),_:2},1024)]),_:2},1024),e(b,{class:"bg-orange text-white"},{default:a(()=>[e(o,null,{default:a(()=>[u(" Expenses ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",Fe,n(t.row.production_cost),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Expected Profit "),je]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.expected_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(J,{color:"primary"}),u(),Re,e(J,{color:"orange"}),e(H,{dense:"",bordered:"",separator:""},{default:a(()=>[e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Total Sales ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.actual_total_sales),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Cash ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.actual_cash),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Mpesa ")]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.actual_mpesa),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[e(o,null,{default:a(()=>[u(" Actual Profit "),Ge]),_:1}),e(o,{side:""},{default:a(()=>[l("b",null,n(t.row.actual_profit),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),l("div",He,[l("small",null,[l("i",null,"Department: "+n(t.row.department),1)])])]),_:2},1024)]),_:2},1024)],8,ze)]),"top-right":a(()=>[e(z,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=t=>T.value=t),placeholder:"Search",class:"q-mr-md"},{append:a(()=>[e(ce,{name:"search"})]),_:1},8,["modelValue"]),e(B,{onClick:I,round:"",dense:"",color:"primary",size:"small",icon:"add"}),e(B,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:s[1]||(s[1]=t=>se(c(q)))})]),_:1},8,["rows","columns","pagination","filter"])),e(re,{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=t=>p.value=t),persistent:""},{default:a(()=>[e(S,{style:{width:"700px"}},{default:a(()=>[e(_e,null,{default:a(()=>[l("div",Je,n(Q.value),1),e(X),l("small",Ke,[We,Xe,e(L,{class:"q-mr-xs"},{default:a(()=>{var t,v;return[u("Total: "+n((v=(t=c(x))==null?void 0:t.today_sales_data[0])==null?void 0:v.total_daily_sales),1)]}),_:1}),e(L,{class:"q-mr-xs"},{default:a(()=>{var t,v;return[u("Cash: "+n((v=(t=c(x))==null?void 0:t.today_sales_data[1])==null?void 0:v.total_daily_cash_sales),1)]}),_:1}),e(L,{class:"q-mr-xs"},{default:a(()=>{var t,v;return[u("Mpesa: "+n((v=(t=c(x))==null?void 0:t.today_sales_data[2])==null?void 0:v.total_daily_mpesa_sales),1)]}),_:1})])]),_:1}),e(V,{class:"q-pt-none"},{default:a(()=>[e(z,{outlined:"",dense:"",label:"Actual Cash",modelValue:h.value,"onUpdate:modelValue":s[3]||(s[3]=t=>h.value=t),type:"number"},null,8,["modelValue"])]),_:1}),e(V,{class:"q-pt-none"},{default:a(()=>[e(z,{outlined:"",dense:"",label:"Actual Mpesa",modelValue:g.value,"onUpdate:modelValue":s[4]||(s[4]=t=>g.value=t),type:"number"},null,8,["modelValue"])]),_:1}),l("div",Ye,[l("small",null,n(_.value),1)]),e(ie,{align:"right"},{default:a(()=>[e(B,{flat:"",label:"Cancel",color:"red",onClick:le}),e(X),h.value&&!E.value?(C(),U(B,{key:0,flat:"",label:"Close Day",color:"primary",onClick:ae})):W("",!0),h.value&&E.value?(C(),U(B,{key:1,flat:"",label:"Edit Account",color:"primary",onClick:te})):W("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{va as default};
