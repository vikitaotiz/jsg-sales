import{Q as h}from"./QTd.4d8c3dcf.js";import{r as d,aJ as u,a6 as A,u as s,Q as p,a4 as f,bb as o,d as t,ad as x,bD as B,a5 as v,bE as Q,a7 as D}from"./index.f12d4c6e.js";import{Q as R}from"./QTr.39832460.js";import{Q as z}from"./QInput.169897e0.js";import{Q as W}from"./QBtnGroup.97bd0735.js";import{Q as X}from"./QTable.186e89f9.js";import{h as I,Q as Y,a as L}from"./helpers.0ee499c7.js";import{Q as Z}from"./QSpace.3ea65c84.js";import{Q as ee}from"./QCardActions.07abd612.js";import{Q as ae}from"./QDialog.2558a699.js";import{e as te,a as re}from"./excel.5d19a2ad.js";import{u as oe}from"./use-quasar.918193c4.js";import{a as le,u as se}from"./index.2fc80911.js";import{u as ue}from"./category-store.90a875b8.js";import{u as ne}from"./auth-store.eebeef52.js";import"./use-key-composition.db93ebf2.js";import"./use-dark.7993985a.js";import"./uid.9b787859.js";import"./QSeparator.4016704c.js";import"./QList.3403280d.js";import"./rtl.56b12b05.js";import"./module_calls.f56580bb.js";const P=[{name:"name",required:!0,label:"Name",align:"left",field:k=>k.name,format:k=>`${k}`,sortable:!0},{name:"products",align:"center",label:"Products",field:"products",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const ie={class:"q-pa-md"},de={key:0},ce={key:1},me={class:"text-h6"},pe={class:"text-center error_msg"},Ue={__name:"Categories",setup(k){const S=ne(),T=oe(),N=le(),b=ue(),c=d(!1),n=d(!1),y=d(!1),V=d(""),w=d(""),l=d(""),q=d(""),g=d(""),{data:E,isLoading:F,isError:$}=se("categories",()=>b.fetchCategories()),G=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const e=await b.deleteCategory({uuid:a.uuid});e.status==="success"?(N.refetchQueries("categories"),i(e.message,"green","top")):i("There was an error","red","top-right")}},J=()=>{w.value="Add New Category",c.value=!0,y.value=!1},M=a=>{y.value=!0,w.value=`Edit ${a.name}`,l.value=a.name,q.value=a.uuid,c.value=!0},O=async()=>{if(n.value=!0,g.value="",l.value.trim()){const a=await b.createCategory({name:l.value.trim()});a.status==="success"?(N.refetchQueries("categories"),l.value="",c.value=!1,n.value=!1,i(a.message,"green","top")):(n.value=!1,g.value=a.message,i(a.message,"red","top-right"))}else g.value="Name is required!",i("Name is required!","red","top-right")},j=async()=>{n.value=!0;const a={name:l.value.trim(),uuid:q.value};if(a.name){const r=await b.updateCategory(a);r.status==="success"?(N.refetchQueries("categories"),l.value="",c.value=!1,y.value=!1,w.value="",n.value=!1,i(r.message,"green","top")):i("There was an error","red","top-right")}else n.value=!1,g.value="Name is required!",i("Name is required!","red","top-right")},H=()=>{c.value=!1,l.value="",q.value="",g.value=""},i=(a,r,e)=>{T.notify({message:a,color:r,position:e})},K=a=>{const r=a.map(e=>({name:e.name,products:e.products.length,created_at:e.created_at}));te(r,P,re,T,"CategoriesData")};return(a,r)=>(u(),A("div",ie,[s(F)?(u(),A("div",de,"Loading categories...")):s($)?(u(),A("div",ce,"An error has occurred: "+p(s($)),1)):(u(),f(X,{key:2,title:"Categories",rows:s(E),columns:s(P),separator:"cell","row-key":"name",filter:V.value,dense:""},{body:o(e=>[t(R,{props:e},{default:o(()=>{var _,C,m;return[t(h,{key:"name",props:e},{default:o(()=>[x(p(e.row.name),1)]),_:2},1032,["props"]),t(h,{key:"products",props:e},{default:o(()=>[x(p(e.row.products.length),1)]),_:2},1032,["props"]),t(h,{key:"user",props:e},{default:o(()=>[x(p(e.row.user),1)]),_:2},1032,["props"]),t(h,{key:"created_at",props:e},{default:o(()=>[x(p(e.row.created_at),1)]),_:2},1032,["props"]),s(I)((m=(C=(_=s(S))==null?void 0:_.user)==null?void 0:C.user)==null?void 0:m.roles)?(u(),f(h,{key:"actions",props:e},{default:o(()=>[t(B,{color:"blue",name:"edit",onClick:U=>M(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),e.row.products.length===0?(u(),f(B,{key:0,color:"red",name:"delete",onClick:U=>G(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])):v("",!0)]),_:2},1032,["props"])):v("",!0)]}),_:2},1032,["props"])]),"top-right":o(()=>{var e,_,C;return[t(z,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":r[0]||(r[0]=m=>V.value=m),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[t(B,{name:"search"})]),_:1},8,["modelValue"]),s(I)((C=(_=(e=s(S))==null?void 0:e.user)==null?void 0:_.user)==null?void 0:C.roles)?(u(),f(W,{key:0},{default:o(()=>{var m;return[t(Q,{onClick:J,round:"",dense:"",color:"primary",icon:"add",label:"Add"}),((m=s(E))==null?void 0:m.length)>0?(u(),f(Q,{key:0,dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:r[1]||(r[1]=U=>K(s(E)))})):v("",!0)]}),_:1})):v("",!0)]}),_:1},8,["rows","columns","filter"])),t(ae,{modelValue:c.value,"onUpdate:modelValue":r[3]||(r[3]=e=>c.value=e),persistent:""},{default:o(()=>[t(Y,{style:{width:"500px"}},{default:o(()=>[t(L,null,{default:o(()=>[D("div",me,p(w.value),1)]),_:1}),t(L,{class:"q-pt-none"},{default:o(()=>[t(z,{outlined:"",dense:"",label:"Name",modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=e=>l.value=e)},null,8,["modelValue"])]),_:1}),D("div",pe,[D("small",null,p(g.value),1)]),t(ee,{align:"right"},{default:o(()=>[t(Q,{flat:"",label:"Cancel",color:"red",onClick:H}),t(Z),l.value&&!y.value?(u(),f(Q,{key:0,flat:"",label:"Add Category",color:"primary",onClick:O,loading:n.value},null,8,["loading"])):v("",!0),l.value&&y.value?(u(),f(Q,{key:1,flat:"",label:"Edit Category",color:"primary",onClick:j,loading:n.value},null,8,["loading"])):v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ue as default};
