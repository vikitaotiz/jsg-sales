import{Q as v,a as H}from"./QTr.bf11f713.js";import{r as s,aI as b,a5 as N,u as m,P as i,a3 as E,bb as o,b as J,d as t,ac as _,bD as A,bE as y,a6 as B,a4 as S}from"./index.0b664dd1.js";import{Q as w}from"./QInput.61571f2a.js";import{Q as K,c as W,p as X,f as Y,d as Z}from"./paginations.d3658bdb.js";import{a as ee,Q}from"./QCard.16e6c615.js";import{e as ae,a as te}from"./excel.5d19a2ad.js";import{a as le}from"./use-quasar.a4f5c2f8.js";import{a as oe,u as re}from"./index.d92120a6.js";import{u as se}from"./debtor-store.d6bcb0c3.js";import"./use-dark.86fd03d9.js";import"./QSeparator.414b75ff.js";import"./rtl.8422cbb6.js";import"./module_calls.c637478d.js";import"./helpers.d60dad50.js";const P=[{name:"name",required:!0,label:"Name",align:"left",field:h=>h.name,format:h=>`${h}`,sortable:!0},{name:"phone",align:"center",label:"Phone",field:"phone",sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const ne={class:"q-pa-md"},ue={key:0},ie={key:1},de={class:"text-h6"},me={class:"text-center error_msg"},Ve={__name:"Debtors",setup(h){const T=le(),C=oe(),D=se(),V=X(10),d=s(!1),g=s(!1),n=s(!1),x=s(""),k=s(""),r=s(""),c=s(""),p=s(""),q=s(""),f=s(""),{data:U,isLoading:z,isError:$}=re("debtors",()=>D.fetchDebtors()),I=async l=>{if(confirm(`Continue with the operation. Delete ${l.name} ?`)){const e=await D.deleteDebtor({uuid:l.uuid});e.status==="success"?(C.refetchQueries("debtors"),u(e.message,"green","top")):u("There was an error","red","top-right")}},L=()=>{k.value="Add New Debtor",d.value=!0,g.value=!1},F=l=>{g.value=!0,k.value=`Edit ${l.name}`,r.value=l.name,q.value=l.uuid,d.value=!0},M=async()=>{n.value=!0,f.value="";const l={name:r.value.trim(),phone:c.value.trim(),email:p.value.trim()};if(l.name&&l.phone){const a=await D.createDebtor(l);a.status==="success"?(C.refetchQueries("debtors"),r.value="",c.value="",p.value="",d.value=!1,u(a.message,"green","top"),n.value=!1):(f.value=a.message,u(a.message,"red","top-right"),n.value=!1)}else f.value="Name and Phone are required!",u("Name and Phone are required!","red","top-right")},O=async()=>{n.value=!0;const l={name:r.value.trim(),phone:c.value.trim(),email:p.value.trim(),uuid:q.value};if(l.name){const a=await D.updateDebtor(l);a.status==="success"?(C.refetchQueries("debtors"),r.value="",c.value="",p.value="",d.value=!1,g.value=!1,k.value="",u(a.message,"green","top"),n.value=!1):(n.value=!1,u("There was an error","red","top-right"))}else f.value="Name is required!",u("Name is required!","red","top-right"),n.value=!1},R=()=>{d.value=!1,r.value="",q.value="",f.value=""},u=(l,a,e)=>{T.notify({message:l,color:a,position:e})},j=l=>{const a=l.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));ae(a,P,te,T,"DebtorsData")};return(l,a)=>(b(),N("div",ne,[m(z)?(b(),N("div",ue,"Loading debtors...")):m($)?(b(),N("div",ie,"An error has occurred: "+i(m($)),1)):(b(),E(K,{key:2,title:"Debtors",rows:m(U),columns:m(P),pagination:m(V),"onUpdate:pagination":a[2]||(a[2]=e=>J(V)?V.value=e:null),separator:"cell","row-key":"name",filter:x.value,dense:""},{body:o(e=>[t(H,{props:e},{default:o(()=>[t(v,{key:"name",props:e},{default:o(()=>[_(i(e.row.name),1)]),_:2},1032,["props"]),t(v,{key:"phone",props:e},{default:o(()=>[_(i(e.row.phone),1)]),_:2},1032,["props"]),t(v,{key:"email",props:e},{default:o(()=>[_(i(e.row.email),1)]),_:2},1032,["props"]),t(v,{key:"created_at",props:e},{default:o(()=>[_(i(e.row.created_at),1)]),_:2},1032,["props"]),t(v,{key:"user",props:e},{default:o(()=>[_(i(e.row.user),1)]),_:2},1032,["props"]),t(v,{key:"actions",props:e},{default:o(()=>[t(A,{color:"blue",name:"edit",onClick:G=>F(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(A,{color:"red",name:"delete",onClick:G=>I(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":o(()=>[t(w,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[t(A,{name:"search"})]),_:1},8,["modelValue"]),t(y,{onClick:L,round:"",dense:"",color:"primary",size:"small",icon:"add"}),t(y,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=e=>j(m(U)))})]),_:1},8,["rows","columns","pagination","filter"])),t(W,{modelValue:d.value,"onUpdate:modelValue":a[6]||(a[6]=e=>d.value=e),persistent:""},{default:o(()=>[t(ee,{style:{width:"500px"}},{default:o(()=>[t(Q,null,{default:o(()=>[B("div",de,i(k.value),1)]),_:1}),t(Q,{class:"q-pt-none"},{default:o(()=>[t(w,{outlined:"",dense:"",label:"Name",modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value=e)},null,8,["modelValue"])]),_:1}),t(Q,{class:"q-pt-none"},{default:o(()=>[t(w,{outlined:"",dense:"",label:"Phone",modelValue:c.value,"onUpdate:modelValue":a[4]||(a[4]=e=>c.value=e)},null,8,["modelValue"])]),_:1}),t(Q,{class:"q-pt-none"},{default:o(()=>[t(w,{outlined:"",dense:"",label:"Email",modelValue:p.value,"onUpdate:modelValue":a[5]||(a[5]=e=>p.value=e)},null,8,["modelValue"])]),_:1}),B("div",me,[B("small",null,i(f.value),1)]),t(Y,{align:"right"},{default:o(()=>[t(y,{flat:"",label:"Cancel",color:"red",onClick:R}),t(Z),r.value&&!g.value?(b(),E(y,{key:0,flat:"",label:"Add Debtor",color:"primary",onClick:M,loading:n.value},null,8,["loading"])):S("",!0),r.value&&g.value?(b(),E(y,{key:1,flat:"",label:"Edit Debtor",color:"primary",onClick:O,loading:n.value},null,8,["loading"])):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ve as default};
