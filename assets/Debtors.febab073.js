import{Q as f}from"./QTd.1a9ab2b5.js";import{r as s,aJ as v,a6 as q,u as b,Q as m,a4 as N,bb as o,d as l,ad as g,bD as E,bE as h,a7 as A,a5 as S}from"./index.8298741d.js";import{Q as G}from"./QTr.477990d2.js";import{Q as k}from"./QInput.7d552452.js";import{Q as H}from"./QTable.7b930ac1.js";import{Q as K,a as w}from"./helpers.fb1c13fb.js";import{Q as R}from"./QSpace.73238577.js";import{Q as W}from"./QCardActions.97fffd17.js";import{Q as X}from"./QDialog.8e5cc539.js";import{e as Y,a as Z}from"./excel.5d19a2ad.js";import{u as ee}from"./use-quasar.6fd90df3.js";import{a as ae,u as le}from"./index.aeab1b1a.js";import{u as te}from"./debtor-store.6d1bd1ec.js";import"./use-key-composition.d158f3c1.js";import"./use-dark.d4d7a4ef.js";import"./uid.9b787859.js";import"./QSeparator.e342aaa8.js";import"./QList.872f9e9f.js";import"./rtl.da2e2854.js";import"./module_calls.83889699.js";const U=[{name:"name",required:!0,label:"Name",align:"left",field:y=>y.name,format:y=>`${y}`,sortable:!0},{name:"phone",align:"center",label:"Phone",field:"phone",sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const oe={class:"q-pa-md"},re={key:0},se={key:1},ne={class:"text-h6"},ue={class:"text-center error_msg"},Ne={__name:"Debtors",setup(y){const B=ee(),C=ae(),D=te(),c=s(!1),_=s(!1),n=s(!1),V=s(""),Q=s(""),r=s(""),u=s(""),i=s(""),x=s(""),p=s(""),{data:T,isLoading:P,isError:$}=le("debtors",()=>D.fetchDebtors()),z=async t=>{if(confirm(`Continue with the operation. Delete ${t.name} ?`)){const e=await D.deleteDebtor({uuid:t.uuid});e.status==="success"?(C.refetchQueries("debtors"),d(e.message,"green","top")):d("There was an error","red","top-right")}},I=()=>{Q.value="Add New Debtor",c.value=!0,_.value=!1},L=t=>{_.value=!0,Q.value=`Edit ${t.name}`,r.value=t.name,u.value=t.phone,i.value=t.email,x.value=t.uuid,c.value=!0},O=async()=>{n.value=!0,p.value="";const t={name:r.value.trim(),phone:u.value.trim(),email:i.value.trim()};if(t.name&&t.phone){const a=await D.createDebtor(t);a.status==="success"?(C.refetchQueries("debtors"),r.value="",u.value="",i.value="",c.value=!1,d(a.message,"green","top"),n.value=!1):(p.value=a.message,d(a.message,"red","top-right"),n.value=!1)}else p.value="Name and Phone are required!",d("Name and Phone are required!","red","top-right")},F=async()=>{n.value=!0;const t={name:r.value.trim(),phone:u.value.trim(),email:i.value.trim(),uuid:x.value};if(t.name){const a=await D.updateDebtor(t);a.status==="success"?(C.refetchQueries("debtors"),r.value="",u.value="",i.value="",c.value=!1,_.value=!1,Q.value="",d(a.message,"green","top"),n.value=!1):(n.value=!1,d("There was an error","red","top-right"))}else p.value="Name is required!",d("Name is required!","red","top-right"),n.value=!1},J=()=>{c.value=!1,r.value="",u.value="",i.value="",x.value="",p.value=""},d=(t,a,e)=>{B.notify({message:t,color:a,position:e})},M=t=>{const a=t.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));Y(a,U,Z,B,"DebtorsData")};return(t,a)=>(v(),q("div",oe,[b(P)?(v(),q("div",re,"Loading debtors...")):b($)?(v(),q("div",se,"An error has occurred: "+m(b($)),1)):(v(),N(H,{key:2,title:"Debtors",rows:b(T),columns:b(U),separator:"cell","row-key":"name",filter:V.value,dense:""},{body:o(e=>[l(G,{props:e},{default:o(()=>[l(f,{key:"name",props:e},{default:o(()=>[g(m(e.row.name),1)]),_:2},1032,["props"]),l(f,{key:"phone",props:e},{default:o(()=>[g(m(e.row.phone),1)]),_:2},1032,["props"]),l(f,{key:"email",props:e},{default:o(()=>[g(m(e.row.email?e.row.email:"N/A"),1)]),_:2},1032,["props"]),l(f,{key:"created_at",props:e},{default:o(()=>[g(m(e.row.created_at),1)]),_:2},1032,["props"]),l(f,{key:"user",props:e},{default:o(()=>[g(m(e.row.user),1)]),_:2},1032,["props"]),l(f,{key:"actions",props:e},{default:o(()=>[l(E,{color:"blue",name:"edit",onClick:j=>L(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),l(E,{color:"red",name:"delete",onClick:j=>z(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":o(()=>[l(k,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[l(E,{name:"search"})]),_:1},8,["modelValue"]),l(h,{onClick:I,round:"",dense:"",color:"primary",size:"small",icon:"add"}),l(h,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=e=>M(b(T)))})]),_:1},8,["rows","columns","filter"])),l(X,{modelValue:c.value,"onUpdate:modelValue":a[5]||(a[5]=e=>c.value=e),persistent:""},{default:o(()=>[l(K,{style:{width:"500px"}},{default:o(()=>[l(w,null,{default:o(()=>[A("div",ne,m(Q.value),1)]),_:1}),l(w,{class:"q-pt-none"},{default:o(()=>[l(k,{outlined:"",dense:"",label:"Name",modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value=e)},null,8,["modelValue"])]),_:1}),l(w,{class:"q-pt-none"},{default:o(()=>[l(k,{outlined:"",dense:"",label:"Phone",modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=e=>u.value=e)},null,8,["modelValue"])]),_:1}),l(w,{class:"q-pt-none"},{default:o(()=>[l(k,{outlined:"",dense:"",label:"Email (Optional)",modelValue:i.value,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value=e)},null,8,["modelValue"])]),_:1}),A("div",ue,[A("small",null,m(p.value),1)]),l(W,{align:"right"},{default:o(()=>[l(h,{flat:"",label:"Cancel",color:"red",onClick:J}),l(R),r.value&&!_.value?(v(),N(h,{key:0,flat:"",label:"Add Debtor",color:"primary",onClick:O,loading:n.value},null,8,["loading"])):S("",!0),r.value&&_.value?(v(),N(h,{key:1,flat:"",label:"Edit Debtor",color:"primary",onClick:F,loading:n.value},null,8,["loading"])):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ne as default};
