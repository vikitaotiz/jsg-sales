import{Q as p,a as re}from"./QTr.401870aa.js";import{c9 as oe,c8 as ue,r as c,j as ie,aI as b,a5 as T,u as Q,P as r,a3 as S,bb as l,d as e,ac as i,bD as N,bE as k,a6 as v,a4 as $}from"./index.104f6ae1.js";import{Q as h}from"./QInput.2343ca30.js";import{Q as se}from"./QBtnGroup.fcc107dc.js";import{Q as de,c as G,d as q,f as R,e as ce}from"./QCardActions.e5ce3c72.js";import{a as Y,Q as A}from"./QBadge.e5611531.js";import{a as H,Q as P}from"./QCard.4f99fc1d.js";import{e as me,a as pe}from"./excel.5d19a2ad.js";import{a as ve}from"./use-quasar.f532f3dd.js";import{a as ye,u as J}from"./index.3178a3ef.js";import{g as fe,p as M}from"./module_calls.c637478d.js";import{u as _e}from"./product-store.c13069a5.js";import"./use-dark.abb6de42.js";import"./QSeparator.66c9c541.js";import"./rtl.9bf9d968.js";import"./helpers.d60dad50.js";const K=[{name:"product",required:!0,label:"Product",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"quantity",align:"center",label:"Quantity",field:"quantity",sortable:!0},{name:"total",align:"center",label:"Total Cost",field:"total",sortable:!0},{name:"measurement",align:"center",label:"Measurement",field:"measurement",sortable:!0},{name:"department",align:"center",label:"Department",field:"department",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],I=oe(),f=I==null?void 0:I.token,ge=ue("inventories",{state:()=>({inventories:[]}),actions:{async fetchInventories(){if(f){const o=await fe("inventories",f);return this.inventories=o==null?void 0:o.data,this.inventories}},async createInventory(o){var _;if(o.user_uuid=(_=I==null?void 0:I.user)==null?void 0:_.uuid,f)return await M(o,"inventories",f)},async updateInventory(o){if(f)return await M(o,"update_inventory",f)},async deleteInventory(o){if(f)return await M(o,"delete_inventory",f)}}});const be={class:"q-pa-md"},Qe={key:0},ke={key:1},we={class:"text-center error_msg"},Ie={class:"text-h6"},Ve={key:0},Ce=v("br",null,null,-1),he={class:"text-center error_msg"},je={__name:"Inventories",setup(o){const _=ve(),x=ye(),B=ge(),z=_e(),w=c(!1),y=c(!1),V=c(!1),U=c(!1),D=c(""),C=c(""),s=c(1),d=c(1),u=ie({product_id:"",measurement_id:""}),E=c(""),g=c(""),{data:L,isLoading:W,isError:O}=J("inventories",()=>B.fetchInventories()),{data:X}=J("products",()=>z.fetchProducts()),Z=async n=>{if(confirm(`Continue with the operation. Delete ${n.name} ?`)){const t=await B.deleteInventory({uuid:n.uuid});t.status==="success"?(x.refetchQueries("inventories"),m(t.message,"green","top")):m("There was an error","red","top-right")}},ee=()=>{z.products.length===0?m("You need to create at least one PRODUCT in order to create inventories!","orange","top"):(C.value="Create Inventory",w.value=!0,U.value=!1)},te=n=>{s.value=n.quantity,d.value=n.buying_price,C.value=`Update Actual Quantity for  ${n.product}`,E.value=n,V.value=!0},ae=async()=>{y.value=!0,g.value="";const n={product_uuid:u.product_id.uuid,measurement_name:u.product_id.measurement,quantity:s.value,buying_price:d.value};if(n.product_uuid&&n.measurement_name&&n.quantity&&n.buying_price){const a=await B.createInventory(n);a.status==="success"?(x.refetchQueries("inventories"),u.product_id="",u.measurement_id="",s.value=1,u.buying_price=1,w.value=!1,y.value=!1,m(a.message,"green","top")):(g.value=a.message,m(a.message,"red","top-right"))}else y.value=!1,g.value="Product, Quantity and Buying Price are required!",m("Product, Quantity and Buying Price are required!","red","top-right")},j=async()=>{y.value=!0;const n={quantity:Number(s.value),buying_price:Number(d.value),inventory_uuid:E.value.uuid};if(n.quantity&&n.buying_price){const a=await B.updateInventory(n);a.status==="success"?(x.refetchQueries("inventories"),s.value=1,d.value=1,w.value=!1,V.value=!1,U.value=!1,C.value="",y.value=!1,m(a.message,"green","top")):m("There was an error","red","top-right")}else y.value=!1,g.value="Quantity and Buying price are required!",m("Quantity and Buying price are required!","red","top-right")},F=()=>{w.value=!1,V.value=!1,u.product_id="",s.value=1,d.value=1,E.value="",g.value=""},m=(n,a,t)=>{_.notify({message:n,color:a,position:t})},le=n=>{const a=n.map(t=>({name:t.name,inventories:t.inventories.length,created_at:t.created_at}));me(a,K,pe,_,"InventoriesData")};return(n,a)=>(b(),T("div",be,[Q(W)?(b(),T("div",Qe,"Loading inventories...")):Q(O)?(b(),T("div",ke,"An error has occurred: "+r(Q(O)),1)):(b(),S(de,{key:2,title:"Purchases/Inventories",rows:Q(L),columns:Q(K),separator:"cell","row-key":"name",filter:D.value,dense:""},{body:l(t=>[e(re,{props:t},{default:l(()=>[e(p,{key:"product",props:t},{default:l(()=>[i(r(t.row.product),1)]),_:2},1032,["props"]),e(p,{key:"buying_price",props:t},{default:l(()=>[i(r(t.row.buying_price),1)]),_:2},1032,["props"]),e(p,{key:"quantity",props:t},{default:l(()=>[i(r(t.row.quantity),1)]),_:2},1032,["props"]),e(p,{key:"total",props:t},{default:l(()=>[i(r(t.row.total),1)]),_:2},1032,["props"]),e(p,{key:"measurement",props:t},{default:l(()=>[i(r(t.row.measurement),1)]),_:2},1032,["props"]),e(p,{key:"department",props:t},{default:l(()=>[i(r(t.row.department),1)]),_:2},1032,["props"]),e(p,{key:"user",props:t},{default:l(()=>[i(r(t.row.user),1)]),_:2},1032,["props"]),e(p,{key:"created_at",props:t},{default:l(()=>[i(r(t.row.created_at),1)]),_:2},1032,["props"]),e(p,{key:"actions",props:t},{default:l(()=>[e(N,{color:"blue",name:"edit",onClick:ne=>te(t.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),e(N,{color:"red",name:"delete",onClick:ne=>Z(t.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":l(()=>[e(h,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=t=>D.value=t),placeholder:"Search",class:"q-mr-md"},{append:l(()=>[e(N,{name:"search"})]),_:1},8,["modelValue"]),e(se,null,{default:l(()=>[e(k,{onClick:ee,dense:"",color:"primary",icon:"add",label:"Add"}),e(k,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=t=>le(Q(L)))})]),_:1})]),_:1},8,["rows","columns","filter"])),e(G,{modelValue:V.value,"onUpdate:modelValue":a[4]||(a[4]=t=>V.value=t),persistent:""},{default:l(()=>[e(H,{style:{width:"500px"}},{default:l(()=>[e(Y,null,{default:l(()=>[i(r(C.value)+" ",1),e(q),v("small",null,[e(A,null,{default:l(()=>[i("Total: "+r(s.value*d.value),1)]),_:1})])]),_:1}),e(P,null,{default:l(()=>[e(h,{dense:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=t=>s.value=t),label:"Actual Quantity",type:"number"},null,8,["modelValue"])]),_:1}),e(P,null,{default:l(()=>[e(h,{dense:"",outlined:"",modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=t=>d.value=t),label:"Buying Price",type:"number"},null,8,["modelValue"])]),_:1}),v("div",we,[v("small",null,r(g.value),1)]),e(R,{align:"right"},{default:l(()=>[e(k,{flat:"",label:"Cancel",color:"red",onClick:F}),e(q),e(k,{flat:"",label:"Edit Inventory",color:"primary",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(G,{modelValue:w.value,"onUpdate:modelValue":a[8]||(a[8]=t=>w.value=t),persistent:""},{default:l(()=>[e(H,{style:{width:"600px"}},{default:l(()=>[e(Y,null,{default:l(()=>[v("div",Ie,r(C.value),1),e(q),v("small",null,[v("i",null,"Total: "+r(s.value*d.value),1)]),e(q),u.product_id?(b(),T("small",Ve,[e(A,{class:"q-mr-sm"},{default:l(()=>[i("Measurement: "+r(u.product_id.measurement),1)]),_:1}),e(A,null,{default:l(()=>[i("Available Quantity: "+r(u.product_id.quantity),1)]),_:1}),Ce,e(A,null,{default:l(()=>[i("Previous Buying Price: "+r(u.product_id.buying_price),1)]),_:1})])):$("",!0)]),_:1}),e(P,null,{default:l(()=>[e(ce,{dense:"",outlined:"",modelValue:u.product_id,"onUpdate:modelValue":a[5]||(a[5]=t=>u.product_id=t),options:Q(X),"option-value":"uuid","option-label":"name",label:"Select Product"},null,8,["modelValue","options"])]),_:1}),e(P,null,{default:l(()=>[e(h,{dense:"",outlined:"",modelValue:s.value,"onUpdate:modelValue":a[6]||(a[6]=t=>s.value=t),label:"Product Quantity",type:"number"},null,8,["modelValue"])]),_:1}),e(P,null,{default:l(()=>[e(h,{dense:"",outlined:"",modelValue:d.value,"onUpdate:modelValue":a[7]||(a[7]=t=>d.value=t),label:"Buying Price (Per Unit)",type:"number"},null,8,["modelValue"])]),_:1}),v("div",he,[v("small",null,r(g.value),1)]),e(R,{align:"right"},{default:l(()=>[e(k,{flat:"",label:"Cancel",color:"red",onClick:F}),e(q),u.product_id&&!U.value?(b(),S(k,{key:0,flat:"",label:"Add Inventory",color:"primary",onClick:ae,loading:y.value},null,8,["loading"])):$("",!0),u.product_id&&U.value?(b(),S(k,{key:1,flat:"",label:"Edit Inventory",color:"primary",onClick:j,loading:y.value},null,8,["loading"])):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{je as default};
