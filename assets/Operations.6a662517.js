import{c5 as de,r as c,c as ce,aI as p,a5 as C,a6 as o,P as u,u as b,a3 as k,bb as a,b as me,d as e,a4 as V,bD as S,ac as r,F as pe,aO as _e,bE as y,M as ve}from"./index.544437db.js";import{Q as z}from"./QBadge.c9e4b02c.js";import{a as B,Q as A}from"./QCard.b1d1b493.js";import{Q as U}from"./QInput.b3c42e3c.js";import{Q as fe,a as H,p as ye,c as M,d as N,b as ge}from"./paginations.dead60bc.js";import{p as F,n as I,o as i}from"./rtl.74f3c00c.js";import{Q as be}from"./QSeparator.3296268e.js";import{Q as he}from"./QBtnGroup.f766cc8c.js";import{Q as R}from"./QToolbar.cf5fbc2b.js";import{a as qe}from"./use-quasar.eb6615ed.js";import{u as j}from"./index.a8c0ae15.js";import{p as Qe}from"./product_columns.33f8ffe3.js";import{u as ke}from"./product-store.2669371c.js";import{u as Se}from"./payment-mode-store.85c762e7.js";import{u as xe}from"./sale-store.daa756f1.js";import{p as we}from"./print.15699711.js";import"./use-dark.7de2cac8.js";import"./module_calls.e16012c0.js";import"./helpers.01ee3f07.js";import"./_commonjsHelpers.6150b38b.js";const Pe={class:"q-pa-md"},Ce={class:"row",style:{overflow:"hidden"}},Ve={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Ne={style:{color:"red"}},Be={key:0},Ae={key:1},$e=["onClick"],De={style:{color:"#017951"}},Ee=o("hr",null,null,-1),Ue=o("hr",null,null,-1),Me=o("br",null,null,-1),Ie=o("br",null,null,-1),Le=o("br",null,null,-1),Te={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},Oe={style:{color:"orange"}},ze=o("br",null,null,-1),He=o("br",null,null,-1),Fe=o("hr",null,null,-1),Re={class:"text-h6"},je={class:"text-center error_msg"},Ge=o("div",{class:"text-h6"},"Make Payment",-1),Ke={class:"q-mt-sm"},Ye={class:"text-center error_msg"},yl={__name:"Operations",setup(Je){const L=de(),G=qe(),K=ke(),Y=Se(),T=xe(),$=ye(10),h=c(!1),x=c(!1),w=c(!0),D=c(""),d=c(1),q=c(1),Q=c(""),J=c(""),_=c(""),E=c(""),m=c(""),n=c([]),{data:W,isLoading:X,isError:O}=j("products",()=>K.fetchProducts()),{data:Z}=j("payment_modes",()=>Y.fetchPaymentModes()),ee=s=>{_.value="",E.value="",n.value.some(t=>t.name==s.name)?(_.value="Product already added to the bill! Select a different product.",E.value="Product already added to the bill! Select a different product.",v(`${s.name} already added to the bill!`,"red","top")):(x.value=!0,m.value=s)},le=()=>{h.value=!0},ae=()=>{x.value=!1,m.value="",d.value=1},te=()=>{if(d.value>m.value.quantity)_.value=`${d.value} is more than the maximum available quantity`,v(`${d.value} is more than the maximum available quantity`,"red","top");else{const s={uuid:m.value.uuid,name:m.value.name,price:m.value.selling_price,quantity:d.value};n.value.push(s),v(`${m.value.name} added to cart!`,"green","top"),x.value=!1,m.value="",d.value=1}},P=ce(()=>{let s=0;return n.value.forEach(t=>{s+=t.quantity*t.price}),s}),oe=s=>n.value.splice(s,1),se=()=>{confirm("Are you sure?")&&(n.value=[])},ue=async()=>{let s=[];n.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const t={products:s,payment_mode_uuid:Q.value.uuid,bill_status:"sold"};if(w.value?(t.selling_price=Number(P.value),t.actual_selling_price=Number(P.value)):(t.selling_price=Number(P.value),t.actual_selling_price=Number(q.value)),t.selling_price&&t.payment_mode_uuid){const l=await T.createSaleOperation(t);l.status==="success"?(Q.value="",d.value="",h.value=!1,n.value=[],L.push("/bills"),v(l.message,"green","top")):(_.value=l.message,v(l.message,"red","top-right"))}else _.value="Name is required!",v("Name is required!","red","top-right")},re=async()=>{var l;let s=[];if(confirm("Are you sure?")){n.value.forEach(f=>s.push({name:f.name,quantity:f.quantity,uuid:f.uuid}));const g={products:s};if((l=g==null?void 0:g.products)!=null&&l.length){const f=await T.createHoldBillOperation(g);f.status==="success"?(Q.value="",d.value="",h.value=!1,n.value=[],L.push("/bills"),v(f.message,"green","top")):(_.value=f.message,v(f.message,"red","top-right"))}else _.value="Name is required!",v("Name is required!","red","top-right")}},ne=()=>{h.value=!1,d.value="",J.value="",_.value=""},v=(s,t,l)=>{G.notify({message:s,color:t,position:l})},ie=()=>{we({printable:n.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,t)=>(p(),C("div",Pe,[o("div",Ce,[o("div",Ve,[o("small",Ne,u(E.value),1),b(X)?(p(),C("div",Be,"Loading products...")):b(O)?(p(),C("div",Ae,"An error has occurred: "+u(b(O)),1)):(p(),k(fe,{key:2,title:"Make Sale (All Products)",rows:b(W),columns:b(Qe),pagination:b($),"onUpdate:pagination":t[1]||(t[1]=l=>me($)?$.value=l:null),separator:"cell","row-key":"name",filter:D.value,dense:"",grid:""},{item:a(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:g=>ee(l.row)},[e(B,{bordered:"",class:"selected_product"},{default:a(()=>[e(A,{class:"text-center"},{default:a(()=>[o("strong",De,[e(S,{name:"bubble_chart"}),r(" "+u(l.row.name),1)]),Ee,o("small",null,[o("i",null,[r("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),Ue,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),Me,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)]),Ie,o("small",null,[e(z,{color:"orange"},{default:a(()=>[r("Available Quantity "),Le,r(u(l.row.quantity)+" "+u(l.row.measurement),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)],8,$e)]),"top-right":a(()=>[e(U,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=l=>D.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:a(()=>[e(S,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),n.value.length>0?(p(),C("div",Te,[e(B,{bordered:""},{default:a(()=>[e(M,null,{default:a(()=>[o("i",null,[e(S,{name:"shopping_cart"}),r(" New Bill")]),r(),e(N),o("span",Oe,"(Items: "+u(n.value.length)+")",1)]),_:1}),e(A,null,{default:a(()=>[e(F,{bordered:"",separator:"",dense:"",class:"bill"},{default:a(()=>[e(I,null,{default:a(()=>[e(i,null,{default:a(()=>[r("Name")]),_:1}),e(i,{style:{color:"white"}},{default:a(()=>[r("Price")]),_:1}),e(i,{style:{color:"white"}},{default:a(()=>[r("Quantity")]),_:1}),e(i,{side:"",style:{color:"white"}},{default:a(()=>[r("Total")]),_:1}),e(i,{avatar:""},{default:a(()=>[e(S,{class:"select_list",name:"delete",dense:"",color:"white",onClick:se})]),_:1})]),_:1})]),_:1}),ze,e(F,{bordered:"",separator:"",dense:""},{default:a(()=>[(p(!0),C(pe,null,_e(n.value,(l,g)=>(p(),k(I,{key:l.uuid},{default:a(()=>[e(i,null,{default:a(()=>[r(u(l.name),1)]),_:2},1024),e(i,null,{default:a(()=>[r(u(l.price),1)]),_:2},1024),e(i,null,{default:a(()=>[r(u(l.quantity),1)]),_:2},1024),e(i,{side:""},{default:a(()=>[r(u(l.price*l.quantity),1)]),_:2},1024),e(i,{avatar:""},{default:a(()=>[e(S,{class:"select_list",name:"delete",dense:"",color:"red",onClick:f=>oe(g)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(be,{color:"orange"}),e(I,null,{default:a(()=>[e(i,null,{default:a(()=>[r("Total")]),_:1}),e(i,{avatar:""},{default:a(()=>[r(u(P.value),1)]),_:1}),e(i,{avatar:""})]),_:1})]),_:1}),He,e(he,{spread:"",rounded:""},{default:a(()=>[e(y,{size:"sm",color:"primary",label:"Sale",icon:"grain",onClick:le}),e(y,{size:"sm",color:"orange",label:"Hold Bill",icon:"pan_tool",onClick:re})]),_:1}),Fe,e(y,{color:"primary",flat:"",class:"full-width",label:"Print Bill",icon:"print",onClick:ie})]),_:1})]),_:1})])):V("",!0)]),e(H,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=l=>x.value=l),persistent:""},{default:a(()=>[e(B,{style:{width:"500px"}},{default:a(()=>[e(R,null,{default:a(()=>[o("div",Re,[e(S,{name:"bubble_chart"}),r(" "+u(m.value.name),1)]),e(N),o("small",null,[e(z,null,{default:a(()=>[r(u(m.value.measurement),1)]),_:1})])]),_:1}),e(A,{class:"q-pt-none"},{default:a(()=>[e(U,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=l=>d.value=l),type:"number",hint:`Note : You can sale a maximum of ${m.value.quantity}`},null,8,["modelValue","hint"])]),_:1}),o("div",je,[o("small",null,u(_.value),1)]),e(M,{align:"right"},{default:a(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:ae}),e(N),d.value?(p(),k(y,{key:0,flat:"",label:"Add Product",color:"primary",onClick:te})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:h.value,"onUpdate:modelValue":t[7]||(t[7]=l=>h.value=l),persistent:""},{default:a(()=>[e(B,{style:{width:"500px"}},{default:a(()=>[e(R,null,{default:a(()=>[Ge,e(N),o("small",Ke,[e(y,{size:"sm",dense:"",color:"blue",depressed:"",class:ve(`${w.value?"":"actual_selling_price"}`),onClick:t[4]||(t[4]=l=>w.value=!w.value),label:`Expected Selling Price : ${P.value}`},null,8,["class","label"])])]),_:1}),e(A,{class:"q-pt-none"},{default:a(()=>[w.value?V("",!0):(p(),k(U,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:q.value,"onUpdate:modelValue":t[5]||(t[5]=l=>q.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),q.value&&q.value>0?(p(),k(ge,{key:1,dense:"",outlined:"",modelValue:Q.value,"onUpdate:modelValue":t[6]||(t[6]=l=>Q.value=l),options:b(Z),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):V("",!0)]),_:1}),o("div",Ye,[o("small",null,u(_.value),1)]),e(M,{align:"right"},{default:a(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:ne}),e(N),q.value&&Q.value?(p(),k(y,{key:0,flat:"",label:"Sale",color:"primary",onClick:ue})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{yl as default};
