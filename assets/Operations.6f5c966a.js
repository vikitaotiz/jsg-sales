import{c5 as me,r,c as pe,aI as m,a5 as k,a6 as o,P as u,u as g,a3 as S,bb as t,b as _e,d as e,a4 as V,bD as w,ac as n,F as ve,aO as fe,bE as b,M as ye}from"./index.bc27483f.js";import{Q as F}from"./QBadge.c1e0609e.js";import{a as B,Q as M}from"./QCard.7d1d294b.js";import{Q as N}from"./QInput.e3697c5f.js";import{Q as be,a as R,p as he,c as L,d as A,b as ge}from"./paginations.fcc2a0de.js";import{p as j,n as T,o as i}from"./rtl.f0ddda94.js";import{Q as qe}from"./QSeparator.df4475a1.js";import{Q as Qe}from"./QBtnGroup.4c23ce1f.js";import{Q as G}from"./QToolbar.5d923135.js";import{a as ke}from"./use-quasar.e5ac4fd4.js";import{u as K}from"./index.4c42915d.js";import{p as Se}from"./product_columns.33f8ffe3.js";import{u as Ve}from"./product-store.32e5bc06.js";import{u as we}from"./payment-mode-store.21a5b03d.js";import{u as xe}from"./sale-store.54bd3272.js";import{p as Ce}from"./print.15699711.js";import"./use-dark.c0bb3fd4.js";import"./module_calls.e16012c0.js";import"./helpers.01ee3f07.js";import"./_commonjsHelpers.6150b38b.js";const Pe={class:"q-pa-md"},Ne={class:"row",style:{overflow:"hidden"}},Ae={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Be={style:{color:"red"}},Me={key:0},$e={key:1},Ue=["onClick"],De={style:{color:"#017951"}},Ee=o("hr",null,null,-1),Ie=o("hr",null,null,-1),Le=o("br",null,null,-1),Te=o("br",null,null,-1),Oe=o("br",null,null,-1),ze={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},He={style:{color:"orange"}},Fe=o("br",null,null,-1),Re=o("br",null,null,-1),je=o("hr",null,null,-1),Ge={class:"text-h6"},Ke={class:"text-center error_msg"},Ye=o("div",{class:"text-h6"},"Make Payment",-1),Je={class:"q-mt-sm"},We={key:2,class:"q-pa-sm"},Xe={class:"row q-col-gutter-sm"},Ze={class:"text-center error_msg"},ql={__name:"Operations",setup(el){const O=me(),Y=ke(),J=Ve(),W=we(),z=xe(),$=he(10),q=r(!1),x=r(!1),C=r(!0),U=r(""),c=r(1),Q=r(1),D=r(1),E=r(1),_=r(""),X=r(""),v=r(""),I=r(""),p=r(""),d=r([]),{data:Z,isLoading:ee,isError:H}=K("products",()=>J.fetchProducts()),{data:le}=K("payment_modes",()=>W.fetchPaymentModes()),ae=s=>{v.value="",I.value="",d.value.some(a=>a.name==s.name)?(v.value="Product already added to the bill! Select a different product.",I.value="Product already added to the bill! Select a different product.",f(`${s.name} already added to the bill!`,"red","top")):(x.value=!0,p.value=s)},te=()=>{q.value=!0},oe=()=>{x.value=!1,p.value="",c.value=1},se=()=>{if(c.value>p.value.quantity)v.value=`${c.value} is more than the maximum available quantity`,f(`${c.value} is more than the maximum available quantity`,"red","top");else{const s={uuid:p.value.uuid,name:p.value.name,price:p.value.selling_price,quantity:c.value};d.value.push(s),f(`${p.value.name} added to cart!`,"green","top"),x.value=!1,p.value="",c.value=1}},P=pe(()=>{let s=0;return d.value.forEach(a=>{s+=a.quantity*a.price}),s}),ue=s=>d.value.splice(s,1),ne=()=>{confirm("Are you sure?")&&(d.value=[])},re=async()=>{let s=[];d.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const a={products:s,payment_mode_uuid:_.value.uuid,bill_status:"sold"};if(_.value.name==="Mpesa & Cash"){const l=Number(D.value)+Number(E.value);a.selling_price=l,a.actual_selling_price=l}else C.value?(a.selling_price=Number(P.value),a.actual_selling_price=Number(P.value)):(a.selling_price=Number(P.value),a.actual_selling_price=Number(Q.value));if(a.selling_price&&a.payment_mode_uuid){const l=await z.createSaleOperation(a);l.status==="success"?(_.value="",c.value="",q.value=!1,d.value=[],O.push("/bills"),f(l.message,"green","top")):(v.value=l.message,f(l.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")},de=async()=>{var l;let s=[];if(confirm("Are you sure?")){d.value.forEach(y=>s.push({name:y.name,quantity:y.quantity,uuid:y.uuid}));const h={products:s};if((l=h==null?void 0:h.products)!=null&&l.length){const y=await z.createHoldBillOperation(h);y.status==="success"?(_.value="",c.value="",q.value=!1,d.value=[],O.push("/bills"),f(y.message,"green","top")):(v.value=y.message,f(y.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")}},ie=()=>{q.value=!1,c.value="",X.value="",v.value=""},f=(s,a,l)=>{Y.notify({message:s,color:a,position:l})},ce=()=>{Ce({printable:d.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,a)=>(m(),k("div",Pe,[o("div",Ne,[o("div",Ae,[o("small",Be,u(I.value),1),g(ee)?(m(),k("div",Me,"Loading products...")):g(H)?(m(),k("div",$e,"An error has occurred: "+u(g(H)),1)):(m(),S(be,{key:2,title:"Make Sale (All Products)",rows:g(Z),columns:g(Se),pagination:g($),"onUpdate:pagination":a[1]||(a[1]=l=>_e($)?$.value=l:null),separator:"cell","row-key":"name",filter:U.value,dense:"",grid:""},{item:t(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:h=>ae(l.row)},[e(B,{bordered:"",class:"selected_product"},{default:t(()=>[e(M,{class:"text-center"},{default:t(()=>[o("strong",De,[e(w,{name:"bubble_chart"}),n(" "+u(l.row.name),1)]),Ee,o("small",null,[o("i",null,[n("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),Ie,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),Le,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)]),Te,o("small",null,[e(F,{color:"orange"},{default:t(()=>[n("Available Quantity "),Oe,n(u(l.row.quantity)+" "+u(l.row.measurement),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)],8,Ue)]),"top-right":t(()=>[e(N,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=l=>U.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:t(()=>[e(w,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),d.value.length>0?(m(),k("div",ze,[e(B,{bordered:""},{default:t(()=>[e(L,null,{default:t(()=>[o("i",null,[e(w,{name:"shopping_cart"}),n(" New Bill")]),n(),e(A),o("span",He,"(Items: "+u(d.value.length)+")",1)]),_:1}),e(M,null,{default:t(()=>[e(j,{bordered:"",separator:"",dense:"",class:"bill"},{default:t(()=>[e(T,null,{default:t(()=>[e(i,null,{default:t(()=>[n("Name")]),_:1}),e(i,{style:{color:"white"}},{default:t(()=>[n("Price")]),_:1}),e(i,{style:{color:"white"}},{default:t(()=>[n("Quantity")]),_:1}),e(i,{side:"",style:{color:"white"}},{default:t(()=>[n("Total")]),_:1}),e(i,{avatar:""},{default:t(()=>[e(w,{class:"select_list",name:"delete",dense:"",color:"white",onClick:ne})]),_:1})]),_:1})]),_:1}),Fe,e(j,{bordered:"",separator:"",dense:""},{default:t(()=>[(m(!0),k(ve,null,fe(d.value,(l,h)=>(m(),S(T,{key:l.uuid},{default:t(()=>[e(i,null,{default:t(()=>[n(u(l.name),1)]),_:2},1024),e(i,null,{default:t(()=>[n(u(l.price),1)]),_:2},1024),e(i,null,{default:t(()=>[n(u(l.quantity),1)]),_:2},1024),e(i,{side:""},{default:t(()=>[n(u(l.price*l.quantity),1)]),_:2},1024),e(i,{avatar:""},{default:t(()=>[e(w,{class:"select_list",name:"delete",dense:"",color:"red",onClick:y=>ue(h)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(qe,{color:"orange"}),e(T,null,{default:t(()=>[e(i,null,{default:t(()=>[n("Total")]),_:1}),e(i,{avatar:""},{default:t(()=>[n(u(P.value),1)]),_:1}),e(i,{avatar:""})]),_:1})]),_:1}),Re,e(Qe,{spread:"",rounded:""},{default:t(()=>[e(b,{size:"sm",color:"primary",label:"Sale",icon:"grain",onClick:te}),e(b,{size:"sm",color:"orange",label:"Hold Bill",icon:"pan_tool",onClick:de})]),_:1}),je,e(b,{color:"primary",flat:"",class:"full-width",label:"Print Bill",icon:"print",onClick:ce})]),_:1})]),_:1})])):V("",!0)]),e(R,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=l=>x.value=l),persistent:""},{default:t(()=>[e(B,{style:{width:"500px"}},{default:t(()=>[e(G,null,{default:t(()=>[o("div",Ge,[e(w,{name:"bubble_chart"}),n(" "+u(p.value.name),1)]),e(A),o("small",null,[e(F,null,{default:t(()=>[n(u(p.value.measurement),1)]),_:1})])]),_:1}),e(M,{class:"q-pt-none"},{default:t(()=>[e(N,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),type:"number",hint:`Note : You can sale a maximum of ${p.value.quantity}`},null,8,["modelValue","hint"])]),_:1}),o("div",Ke,[o("small",null,u(v.value),1)]),e(L,{align:"right"},{default:t(()=>[e(b,{flat:"",label:"Cancel",color:"red",onClick:oe}),e(A),c.value?(m(),S(b,{key:0,flat:"",label:"Add Product",color:"primary",onClick:se})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{modelValue:q.value,"onUpdate:modelValue":a[9]||(a[9]=l=>q.value=l),persistent:""},{default:t(()=>[e(B,{style:{width:"500px"}},{default:t(()=>[e(G,null,{default:t(()=>[Ye,e(A),o("small",Je,[e(b,{disabled:_.value.name==="Mpesa & Cash",size:"sm",dense:"",color:"blue",depressed:"",class:ye(`${C.value?"":"actual_selling_price"}`),onClick:a[4]||(a[4]=l=>C.value=!C.value),label:`Expected Selling Price : ${P.value}`},null,8,["disabled","class","label"])])]),_:1}),e(M,{class:"q-pt-none"},{default:t(()=>[!C.value&&_.value.name!=="Mpesa & Cash"?(m(),S(N,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:Q.value,"onUpdate:modelValue":a[5]||(a[5]=l=>Q.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])):V("",!0),Q.value&&Q.value>0?(m(),S(ge,{key:1,dense:"",outlined:"",modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=l=>_.value=l),options:g(le),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):V("",!0),_.value.name==="Mpesa & Cash"?(m(),k("div",We,[o("div",Xe,[e(N,{outlined:"",dense:"",class:"col-6",label:"Mpesa Amount",type:"number",modelValue:D.value,"onUpdate:modelValue":a[7]||(a[7]=l=>D.value=l)},null,8,["modelValue"]),e(N,{outlined:"",dense:"",class:"col-6",label:"Cash Amount",type:"number",modelValue:E.value,"onUpdate:modelValue":a[8]||(a[8]=l=>E.value=l)},null,8,["modelValue"])])])):V("",!0)]),_:1}),o("div",Ze,[o("small",null,u(v.value),1)]),e(L,{align:"right"},{default:t(()=>[e(b,{flat:"",label:"Cancel",color:"red",onClick:ie}),e(A),Q.value&&_.value?(m(),S(b,{key:0,flat:"",label:"Sale",color:"primary",onClick:re})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ql as default};
