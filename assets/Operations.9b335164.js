import{c5 as pe,r,c as _e,aI as m,a5 as S,a6 as o,P as u,u as h,a3 as V,bb as t,b as ve,d as e,a4 as w,bD as x,ac as n,F as fe,aO as ye,bE as b,M as be}from"./index.43b29598.js";import{Q as R,a as j}from"./QBadge.c37ec33e.js";import{a as M,Q as $}from"./QCard.287aa4cb.js";import{Q as B}from"./QInput.50502b6a.js";import{Q as ge,c as G,p as he,f as T,d as A,e as qe}from"./paginations.d31396ff.js";import{p as K,n as O,o as i}from"./rtl.e3274486.js";import{Q as ke}from"./QSeparator.00910b71.js";import{Q as Qe}from"./QBtnGroup.8ab77508.js";import{a as Se}from"./use-quasar.811db318.js";import{u as Y}from"./index.fe5141b8.js";import{p as Ve}from"./product_columns.33f8ffe3.js";import{u as we}from"./product-store.37496ad2.js";import{u as xe}from"./payment-mode-store.c7d091aa.js";import{u as Ce}from"./sale-store.f9d6ab4b.js";import{p as Pe}from"./print.15699711.js";import"./use-dark.ad1ce312.js";import"./module_calls.e16012c0.js";import"./helpers.01ee3f07.js";import"./_commonjsHelpers.6150b38b.js";const Ne={class:"q-pa-md"},Be={class:"row",style:{overflow:"hidden"}},Ae={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Me={style:{color:"red"}},$e={key:0},Ue={key:1},De=["onClick"],Ee={style:{color:"#017951"}},Ie=o("hr",null,null,-1),Le=o("hr",null,null,-1),Te=o("br",null,null,-1),Oe=o("br",null,null,-1),ze=o("br",null,null,-1),He={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},Fe={style:{color:"orange"}},Re=o("br",null,null,-1),je=o("br",null,null,-1),Ge=o("hr",null,null,-1),Ke={class:"text-h6"},Ye={class:"text-center error_msg"},Je=o("div",{class:"text-h6"},"Make Payment",-1),We={class:"q-mt-sm"},Xe={key:2,class:"q-pa-sm"},Ze={class:"row q-col-gutter-sm"},el={class:"text-center error_msg"},ql={__name:"Operations",setup(ll){const z=pe(),J=Se(),W=we(),X=xe(),H=Ce(),U=he(10),q=r(!1),k=r(!1),C=r(!1),P=r(!0),D=r(""),c=r(1),Q=r(1),E=r(1),I=r(1),_=r(""),Z=r(""),v=r(""),L=r(""),p=r(""),d=r([]),{data:ee,isLoading:le,isError:F}=Y("products",()=>W.fetchProducts()),{data:ae}=Y("payment_modes",()=>X.fetchPaymentModes()),te=s=>{v.value="",L.value="",d.value.some(a=>a.name==s.name)?(v.value="Product already added to the bill! Select a different product.",L.value="Product already added to the bill! Select a different product.",f(`${s.name} already added to the bill!`,"red","top")):(C.value=!0,p.value=s)},oe=()=>{k.value=!0},se=()=>{C.value=!1,p.value="",c.value=1},ue=()=>{if(c.value>p.value.quantity)v.value=`${c.value} is more than the maximum available quantity`,f(`${c.value} is more than the maximum available quantity`,"red","top");else{const s={uuid:p.value.uuid,name:p.value.name,price:p.value.selling_price,quantity:c.value};d.value.push(s),f(`${p.value.name} added to cart!`,"green","top"),C.value=!1,p.value="",c.value=1}},N=_e(()=>{let s=0;return d.value.forEach(a=>{s+=a.quantity*a.price}),s}),ne=s=>d.value.splice(s,1),re=()=>{confirm("Are you sure?")&&(d.value=[])},de=async()=>{q.value=!0;let s=[];d.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const a={products:s,payment_mode_uuid:_.value.uuid,bill_status:"sold"};if(_.value.name==="Mpesa & Cash"){const l=Number(E.value)+Number(I.value);a.selling_price=l,a.actual_selling_price=l}else P.value?(a.selling_price=Number(N.value),a.actual_selling_price=Number(N.value)):(a.selling_price=Number(N.value),a.actual_selling_price=Number(Q.value));if(a.selling_price&&a.payment_mode_uuid){const l=await H.createSaleOperation(a);l.status==="success"?(_.value="",c.value="",k.value=!1,d.value=[],q.value=!1,z.push("/bills"),f(l.message,"green","top")):(v.value=l.message,f(l.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")},ie=async()=>{var l;q.value=!0;let s=[];if(confirm("Are you sure?")){d.value.forEach(y=>s.push({name:y.name,quantity:y.quantity,uuid:y.uuid}));const g={products:s};if((l=g==null?void 0:g.products)!=null&&l.length){const y=await H.createHoldBillOperation(g);y.status==="success"?(_.value="",c.value="",k.value=!1,d.value=[],q.value=!1,z.push("/bills"),f(y.message,"green","top")):(v.value=y.message,f(y.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")}},ce=()=>{k.value=!1,c.value="",Z.value="",v.value=""},f=(s,a,l)=>{J.notify({message:s,color:a,position:l})},me=()=>{Pe({printable:d.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,a)=>(m(),S("div",Ne,[o("div",Be,[o("div",Ae,[o("small",Me,u(L.value),1),h(le)?(m(),S("div",$e,"Loading products...")):h(F)?(m(),S("div",Ue,"An error has occurred: "+u(h(F)),1)):(m(),V(ge,{key:2,title:"Make Sale (All Products)",rows:h(ee),columns:h(Ve),pagination:h(U),"onUpdate:pagination":a[1]||(a[1]=l=>ve(U)?U.value=l:null),separator:"cell","row-key":"name",filter:D.value,dense:"",grid:""},{item:t(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:g=>te(l.row)},[e(M,{bordered:"",class:"selected_product"},{default:t(()=>[e($,{class:"text-center"},{default:t(()=>[o("strong",Ee,[e(x,{name:"bubble_chart"}),n(" "+u(l.row.name),1)]),Ie,o("small",null,[o("i",null,[n("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),Le,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),Te,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)]),Oe,o("small",null,[e(R,{color:"orange"},{default:t(()=>[n("Available Quantity "),ze,n(u(l.row.quantity)+" "+u(l.row.measurement),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)],8,De)]),"top-right":t(()=>[e(B,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=l=>D.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:t(()=>[e(x,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),d.value.length>0?(m(),S("div",He,[e(M,{bordered:""},{default:t(()=>[e(T,null,{default:t(()=>[o("i",null,[e(x,{name:"shopping_cart"}),n(" New Bill")]),n(),e(A),o("span",Fe,"(Items: "+u(d.value.length)+")",1)]),_:1}),e($,null,{default:t(()=>[e(K,{bordered:"",separator:"",dense:"",class:"bill"},{default:t(()=>[e(O,null,{default:t(()=>[e(i,null,{default:t(()=>[n("Name")]),_:1}),e(i,{style:{color:"white"}},{default:t(()=>[n("Price")]),_:1}),e(i,{style:{color:"white"}},{default:t(()=>[n("Quantity")]),_:1}),e(i,{side:"",style:{color:"white"}},{default:t(()=>[n("Total")]),_:1}),e(i,{avatar:""},{default:t(()=>[e(x,{class:"select_list",name:"delete",dense:"",color:"white",onClick:re})]),_:1})]),_:1})]),_:1}),Re,e(K,{bordered:"",separator:"",dense:""},{default:t(()=>[(m(!0),S(fe,null,ye(d.value,(l,g)=>(m(),V(O,{key:l.uuid},{default:t(()=>[e(i,null,{default:t(()=>[n(u(l.name),1)]),_:2},1024),e(i,null,{default:t(()=>[n(u(l.price),1)]),_:2},1024),e(i,null,{default:t(()=>[n(u(l.quantity),1)]),_:2},1024),e(i,{side:""},{default:t(()=>[n(u(l.price*l.quantity),1)]),_:2},1024),e(i,{avatar:""},{default:t(()=>[e(x,{class:"select_list",name:"delete",dense:"",color:"red",onClick:y=>ne(g)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(ke,{color:"orange"}),e(O,null,{default:t(()=>[e(i,null,{default:t(()=>[n("Total")]),_:1}),e(i,{avatar:""},{default:t(()=>[n(u(N.value),1)]),_:1}),e(i,{avatar:""})]),_:1})]),_:1}),je,e(Qe,{spread:"",rounded:""},{default:t(()=>[e(b,{size:"sm",color:"primary",label:"Sale",icon:"grain",onClick:oe}),e(b,{size:"sm",color:"orange",label:"Hold Bill",icon:"pan_tool",onClick:ie,loading:q.value},null,8,["loading"])]),_:1}),Ge,e(b,{color:"primary",flat:"",class:"full-width",label:"Print Bill",icon:"print",onClick:me})]),_:1})]),_:1})])):w("",!0)]),e(G,{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=l=>C.value=l),persistent:""},{default:t(()=>[e(M,{style:{width:"500px"}},{default:t(()=>[e(j,null,{default:t(()=>[o("div",Ke,[e(x,{name:"bubble_chart"}),n(" "+u(p.value.name),1)]),e(A),o("small",null,[e(R,null,{default:t(()=>[n(u(p.value.measurement),1)]),_:1})])]),_:1}),e($,{class:"q-pt-none"},{default:t(()=>[e(B,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),type:"number",hint:`Note : You can sale a maximum of ${p.value.quantity}`},null,8,["modelValue","hint"])]),_:1}),o("div",Ye,[o("small",null,u(v.value),1)]),e(T,{align:"right"},{default:t(()=>[e(b,{flat:"",label:"Cancel",color:"red",onClick:se}),e(A),c.value?(m(),V(b,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ue})):w("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(G,{modelValue:k.value,"onUpdate:modelValue":a[9]||(a[9]=l=>k.value=l),persistent:""},{default:t(()=>[e(M,{style:{width:"500px"}},{default:t(()=>[e(j,null,{default:t(()=>[Je,e(A),o("small",We,[e(b,{disabled:_.value.name==="Mpesa & Cash",size:"sm",dense:"",color:"blue",depressed:"",class:be(`${P.value?"":"actual_selling_price"}`),onClick:a[4]||(a[4]=l=>P.value=!P.value),label:`Expected Selling Price : ${N.value}`},null,8,["disabled","class","label"])])]),_:1}),e($,{class:"q-pt-none"},{default:t(()=>[!P.value&&_.value.name!=="Mpesa & Cash"?(m(),V(B,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:Q.value,"onUpdate:modelValue":a[5]||(a[5]=l=>Q.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])):w("",!0),Q.value&&Q.value>0?(m(),V(qe,{key:1,dense:"",outlined:"",modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=l=>_.value=l),options:h(ae),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):w("",!0),_.value.name==="Mpesa & Cash"?(m(),S("div",Xe,[o("div",Ze,[e(B,{outlined:"",dense:"",class:"col-6",label:"Mpesa Amount",type:"number",modelValue:E.value,"onUpdate:modelValue":a[7]||(a[7]=l=>E.value=l)},null,8,["modelValue"]),e(B,{outlined:"",dense:"",class:"col-6",label:"Cash Amount",type:"number",modelValue:I.value,"onUpdate:modelValue":a[8]||(a[8]=l=>I.value=l)},null,8,["modelValue"])])])):w("",!0)]),_:1}),o("div",el,[o("small",null,u(v.value),1)]),e(T,{align:"right"},{default:t(()=>[e(b,{flat:"",label:"Cancel",color:"red",onClick:ce}),e(A),Q.value&&_.value?(m(),V(b,{key:0,flat:"",label:"Sale",color:"primary",onClick:de,loading:q.value},null,8,["loading"])):w("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ql as default};
