import{Q as i,a as de}from"./QTr.401870aa.js";import{Q as ie,a as ce}from"./QBadge.e5611531.js";import{bA as me,c as X,h as U,bB as O,g as pe,r as u,aI as c,a5 as R,u as n,P as r,a3 as h,bb as o,d as l,ac as m,a6 as v,bD as Y,bE as S,a4 as F}from"./index.104f6ae1.js";import{Q as A}from"./QInput.2343ca30.js";import{Q as ve}from"./QBtnGroup.fcc107dc.js";import{Q as _e,c as fe,d as Z,e as H,f as ge}from"./QCardActions.e5ce3c72.js";import{a as ye,Q as N}from"./QCard.4f99fc1d.js";import{u as be,a as ke}from"./use-dark.abb6de42.js";import{e as qe,a as Ve}from"./excel.5d19a2ad.js";import{a as Qe}from"./use-quasar.f532f3dd.js";import{a as we,u as T}from"./index.3178a3ef.js";import{p as ee}from"./product_columns.133b4496.js";import{u as Pe}from"./product-store.c13069a5.js";import{u as Ce}from"./category-store.5b27287f.js";import{u as he}from"./measurement-store.c055a728.js";import{u as Se}from"./department-store.3a49140b.js";import"./QSeparator.66c9c541.js";import"./rtl.9bf9d968.js";import"./module_calls.c637478d.js";import"./helpers.d60dad50.js";var xe=me({name:"QBanner",props:{...be,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(f,{slots:g}){const{proxy:{$q:x}}=pe(),y=ke(f,x),B=X(()=>"q-banner row items-center"+(f.dense===!0?" q-banner--dense":"")+(y.value===!0?" q-banner--dark q-dark":"")+(f.rounded===!0?" rounded-borders":"")),I=X(()=>`q-banner__actions row items-center justify-end col-${f.inlineActions===!0?"auto":"all"}`);return()=>{const D=[U("div",{class:"q-banner__avatar col-auto row items-center self-start"},O(g.avatar)),U("div",{class:"q-banner__content col text-body2"},O(g.default))],s=O(g.action);return s!==void 0&&D.push(U("div",{class:I.value},s)),U("div",{class:B.value+(f.inlineActions===!1&&s!==void 0?" q-banner--top-padding":""),role:"alert"},D)}}});const Ae={class:"q-pa-md"},Be={key:0},De={key:1},Ee={class:"text-h6"},Ue=v("small",null,[v("b",null,"Quantity should be adjusted from inventories...")],-1),Ne={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Te={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Ie={class:"text-center error_msg"},ot={__name:"Products",setup(f){const g=Qe(),x=we(),y=Pe(),B=Ce(),I=he(),D=Se(),s=u(!1),b=u(!1),k=u(!1),$=u(""),E=u(""),J=u(""),_=u(""),p=u(""),q=u(1),V=u(1),Q=u(1),{data:z,isLoading:te,isError:K}=T("products",()=>y.fetchProducts()),w=u("");let M=u([]);const P=u("");let j=u([]);const C=u("");let G=u([]);T("categories",()=>B.fetchCategories(),{onSuccess:a=>{j.value=a.map(t=>({uuid:t.uuid,name:t.name}))}}),T("measurements",()=>I.fetchMeasurements(),{onSuccess:a=>{M.value=a.map(t=>({uuid:t.uuid,name:t.name}))}}),T("departments",()=>D.fetchDepartments(),{onSuccess:a=>{G.value=a.map(t=>({uuid:t.uuid,name:t.name}))}});const ae=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const e=await y.deleteProduct({uuid:a.uuid});e.status==="success"?(x.refetchQueries("products"),d(e.message,"green","top")):d("There was an error","red","top-right")}},le=()=>{b.value=!1,B.categories.length===0?d("You need to create at least one CATEGORY in order to create products!","orange","top"):(E.value="Add New Product",s.value=!0)},oe=a=>{b.value=!0,E.value=`Edit ${a.name}`,J.value=a.uuid,s.value=!0,p.value=a.name,q.value=a.quantity,V.value=a.buying_price,Q.value=a.selling_price,w.value=M.value.find(t=>t.name===a.measurement),P.value=j.value.find(t=>t.name===a.category),C.value=G.value.find(t=>t.name===a.department)},ue=async()=>{_.value="",k.value=!0;const a={name:p.value.trim(),quantity:q.value,selling_price:Q.value,buying_price:V.value,category_uuid:P.value.uuid,department_uuid:C.value.uuid,measurement_uuid:w.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.department_uuid&&a.measurement_uuid){const t=await y.createProduct(a);t.status==="success"?(x.refetchQueries("products"),L(),d(t.message,"green","top")):(_.value=t.message,d(t.message,"red","top-right"))}else _.value="All fields are required!",k.value=!1,d("All fields are required!","red","top-right")},re=async()=>{_.value="",k.value=!0;const a={product_uuid:J.value,name:p.value.trim(),quantity:q.value,selling_price:Q.value,buying_price:V.value,category_uuid:P.value.uuid,department_uuid:C.value.uuid,measurement_uuid:w.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.department_uuid&&a.measurement_uuid){const t=await y.updateProduct(a);t.status==="success"?(x.refetchQueries("products"),L(),d(t.message,"green","top")):d(t.message,"red","top-right")}else _.value="All fields are required!",d("All fields are required!","red","top-right")},ne=()=>L(),d=(a,t,e)=>{g.notify({message:a,color:t,position:e})},L=()=>{p.value="",Q.value=1,V.value=1,P.value="",C.value="",w.value="",q.value=1,s.value=!1,k.value=!1,b.value=!1,E.value="",_.value=""},se=a=>{const t=a.map(e=>({name:e.name,products:e.products.length,created_at:e.created_at}));qe(t,ee,Ve,g,"ProductsData")};return(a,t)=>(c(),R("div",Ae,[n(te)?(c(),R("div",Be,"Loading products...")):n(K)?(c(),R("div",De,"An error has occurred: "+r(n(K)),1)):(c(),h(_e,{key:2,title:"Products",rows:n(z),columns:n(ee),separator:"cell","row-key":"name",filter:$.value,dense:""},{body:o(e=>[l(de,{props:e},{default:o(()=>[l(i,{key:"name",props:e},{default:o(()=>[m(r(e.row.name),1)]),_:2},1032,["props"]),l(i,{key:"measurement",props:e},{default:o(()=>[m(r(e.row.measurement)+" ",1),v("small",null,[l(ie,null,{default:o(()=>[m(": "+r(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),l(i,{key:"buying_price",props:e},{default:o(()=>[m(r(e.row.buying_price),1)]),_:2},1032,["props"]),l(i,{key:"selling_price",props:e},{default:o(()=>[m(r(e.row.selling_price),1)]),_:2},1032,["props"]),l(i,{key:"department",props:e},{default:o(()=>[m(r(e.row.department),1)]),_:2},1032,["props"]),l(i,{key:"category",props:e},{default:o(()=>[m(r(e.row.category),1)]),_:2},1032,["props"]),l(i,{key:"user",props:e},{default:o(()=>[m(r(e.row.user),1)]),_:2},1032,["props"]),l(i,{key:"created_at",props:e},{default:o(()=>[m(r(e.row.created_at),1)]),_:2},1032,["props"]),l(i,{key:"actions",props:e},{default:o(()=>[l(Y,{color:"blue",name:"edit",onClick:W=>oe(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),l(Y,{color:"red",name:"delete",onClick:W=>ae(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":o(()=>[l(A,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=e=>$.value=e),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[l(Y,{name:"search"})]),_:1},8,["modelValue"]),l(ve,null,{default:o(()=>{var e;return[l(S,{onClick:le,dense:"",color:"blue",size:"small",icon:"add",label:"Add"}),((e=n(z))==null?void 0:e.length)>0?(c(),h(S,{key:0,dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:t[1]||(t[1]=W=>se(n(z)))})):F("",!0)]}),_:1})]),_:1},8,["rows","columns","filter"])),l(fe,{modelValue:s.value,"onUpdate:modelValue":t[9]||(t[9]=e=>s.value=e),persistent:""},{default:o(()=>[l(ye,{style:{width:"500px"}},{default:o(()=>[l(N,null,{default:o(()=>[v("div",Ee,r(E.value),1)]),_:1}),l(N,{class:"q-pt-none"},{default:o(()=>[l(A,{outlined:"",dense:"",label:"Name",modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e)},null,8,["modelValue"])]),_:1}),l(N,{class:"q-pt-none"},{default:o(()=>[b.value?(c(),h(xe,{key:1,class:"bg-primary text-white"},{default:o(()=>[l(ce,null,{default:o(()=>[Ue,l(Z),l(S,{label:"INVENTORIES",outline:"",size:"sm",to:"/inventories"})]),_:1})]),_:1})):(c(),h(A,{key:0,outlined:"",dense:"",label:"Initial Quantity",modelValue:q.value,"onUpdate:modelValue":t[3]||(t[3]=e=>q.value=e),type:"number"},null,8,["modelValue"]))]),_:1}),v("div",Ne,[l(A,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=e=>V.value=e),type:"number",class:"col-6"},null,8,["modelValue"]),l(A,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:Q.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Q.value=e),type:"number",class:"col-6"},null,8,["modelValue"])]),v("div",Te,[l(H,{dense:"",outlined:"",modelValue:P.value,"onUpdate:modelValue":t[6]||(t[6]=e=>P.value=e),options:n(j),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),l(H,{dense:"",outlined:"",modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=e=>w.value=e),options:n(M),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),l(N,{class:"q-pt-none"},{default:o(()=>[l(H,{dense:"",outlined:"",modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=e=>C.value=e),options:n(G),"option-value":"uuid","option-label":"name",label:"Select Product Department"},null,8,["modelValue","options"])]),_:1}),v("div",Ie,[v("small",null,r(_.value),1)]),l(ge,{align:"right"},{default:o(()=>[l(S,{flat:"",label:"Cancel",color:"red",onClick:ne}),l(Z),p.value&&!b.value?(c(),h(S,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ue,loading:k.value},null,8,["loading"])):F("",!0),p.value&&b.value?(c(),h(S,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:re,loading:k.value},null,8,["loading"])):F("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ot as default};
