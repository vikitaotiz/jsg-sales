import{Q as d,a as ce}from"./QTr.da10a9bf.js";import{Q as me,a as ee}from"./QBadge.c37ec33e.js";import{bA as pe,c as ae,h as T,bB as L,g as ve,r as o,aI as i,a5 as Y,u as r,P as n,a3 as C,bb as u,b as fe,d as l,ac as c,a6 as x,bD as F,bE as h,a4 as H}from"./index.43b29598.js";import{Q as D}from"./QInput.50502b6a.js";import{Q as _e}from"./QBtnGroup.8ab77508.js";import{Q as ge,c as ye,p as be,d as J,e as K,f as ke}from"./paginations.d31396ff.js";import{a as qe,Q as S}from"./QCard.287aa4cb.js";import{u as Ve,a as Qe}from"./use-dark.ad1ce312.js";import{e as we,a as Pe}from"./excel.5d19a2ad.js";import{a as Ce}from"./use-quasar.811db318.js";import{a as he,u as I}from"./index.fe5141b8.js";import{p as te}from"./product_columns.33f8ffe3.js";import{u as Se}from"./product-store.37496ad2.js";import{u as xe}from"./category-store.26a4b49c.js";import{u as Ae}from"./measurement-store.bfd767c0.js";import{u as Be}from"./department-store.cac42190.js";import"./QSeparator.00910b71.js";import"./rtl.e3274486.js";import"./module_calls.e16012c0.js";import"./helpers.01ee3f07.js";var De=pe({name:"QBanner",props:{...Ve,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(f,{slots:_}){const{proxy:{$q:A}}=ve(),g=Qe(f,A),E=ae(()=>"q-banner row items-center"+(f.dense===!0?" q-banner--dense":"")+(g.value===!0?" q-banner--dark q-dark":"")+(f.rounded===!0?" rounded-borders":"")),$=ae(()=>`q-banner__actions row items-center justify-end col-${f.inlineActions===!0?"auto":"all"}`);return()=>{const U=[T("div",{class:"q-banner__avatar col-auto row items-center self-start"},L(_.avatar)),T("div",{class:"q-banner__content col text-body2"},L(_.default))],p=L(_.action);return p!==void 0&&U.push(T("div",{class:$.value},p)),T("div",{class:E.value+(f.inlineActions===!1&&p!==void 0?" q-banner--top-padding":""),role:"alert"},U)}}});const Ee={class:"q-pa-md"},Ue={key:0},Ne={key:1},Te={class:"text-h6"},Ie=x("small",null,[x("b",null,"Quantity should be adjusted from inventories...")],-1),$e={class:"text-center error_msg"},oa={__name:"Products",setup(f){const _=Ce(),A=he(),g=Se(),E=xe(),$=Ae(),U=Be(),p=be(10),B=o(!1),y=o(!1),b=o(!1),z=o(""),N=o(""),W=o(""),v=o(""),m=o(""),k=o(1),q=o(1),V=o(1),{data:M,isLoading:le,isError:X}=I("products",()=>g.fetchProducts()),Q=o("");let R=o([]);const w=o("");let O=o([]);const P=o("");let j=o([]);I("categories",()=>E.fetchCategories(),{onSuccess:t=>{O.value=t.map(a=>({uuid:a.uuid,name:a.name}))}}),I("measurements",()=>$.fetchMeasurements(),{onSuccess:t=>{R.value=t.map(a=>({uuid:a.uuid,name:a.name}))}}),I("departments",()=>U.fetchDepartments(),{onSuccess:t=>{j.value=t.map(a=>({uuid:a.uuid,name:a.name}))}});const ue=async t=>{if(confirm(`Continue with the operation. Delete ${t.name} ?`)){const e=await g.deleteProduct({uuid:t.uuid});e.status==="success"?(A.refetchQueries("products"),s(e.message,"green","top")):s("There was an error","red","top-right")}},oe=()=>{y.value=!1,E.categories.length===0?s("You need to create at least one PRODUCT CATEGORY in order to create products!","orange","top"):(N.value="Add New Product",B.value=!0)},ne=t=>{y.value=!0,N.value=`Edit ${t.name}`,W.value=t.uuid,B.value=!0,m.value=t.name,k.value=t.quantity,q.value=t.buying_price,V.value=t.selling_price,Q.value=R.value.find(a=>a.name===t.measurement),w.value=O.value.find(a=>a.name===t.category),P.value=j.value.find(a=>a.name===t.department)},re=async()=>{v.value="",b.value=!0;const t={name:m.value.trim(),quantity:k.value,selling_price:V.value,buying_price:q.value,category_uuid:w.value.uuid,department_uuid:P.value.uuid,measurement_uuid:Q.value.uuid};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.department_uuid&&t.measurement_uuid){const a=await g.createProduct(t);a.status==="success"?(A.refetchQueries("products"),G(),s(a.message,"green","top")):(v.value=a.message,s(a.message,"red","top-right"))}else v.value="All fields are required!",b.value=!1,s("All fields are required!","red","top-right")},se=async()=>{v.value="",b.value=!0;const t={product_uuid:W.value,name:m.value.trim(),quantity:k.value,selling_price:V.value,buying_price:q.value,category_uuid:w.value.uuid,department_uuid:P.value.uuid,measurement_uuid:Q.value.uuid};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.department_uuid&&t.measurement_uuid){const a=await g.updateProduct(t);a.status==="success"?(A.refetchQueries("products"),G(),s(a.message,"green","top")):s(a.message,"red","top-right")}else v.value="All fields are required!",s("All fields are required!","red","top-right")},de=()=>G(),s=(t,a,e)=>{_.notify({message:t,color:a,position:e})},G=()=>{m.value="",V.value=1,q.value=1,w.value="",P.value="",Q.value="",k.value=1,B.value=!1,b.value=!1,y.value=!1,N.value="",v.value=""},ie=t=>{const a=t.map(e=>({name:e.name,products:e.products.length,created_at:e.created_at}));we(a,te,Pe,_,"ProductsData")};return(t,a)=>(i(),Y("div",Ee,[r(le)?(i(),Y("div",Ue,"Loading products...")):r(X)?(i(),Y("div",Ne,"An error has occurred: "+n(r(X)),1)):(i(),C(ge,{key:2,title:"Products",rows:r(M),columns:r(te),pagination:r(p),"onUpdate:pagination":a[2]||(a[2]=e=>fe(p)?p.value=e:null),separator:"cell","row-key":"name",filter:z.value,dense:""},{body:u(e=>[l(ce,{props:e},{default:u(()=>[l(d,{key:"name",props:e},{default:u(()=>[c(n(e.row.name),1)]),_:2},1032,["props"]),l(d,{key:"measurement",props:e},{default:u(()=>[c(n(e.row.measurement)+" ",1),x("small",null,[l(me,null,{default:u(()=>[c(": "+n(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),l(d,{key:"buying_price",props:e},{default:u(()=>[c(n(e.row.buying_price),1)]),_:2},1032,["props"]),l(d,{key:"selling_price",props:e},{default:u(()=>[c(n(e.row.selling_price),1)]),_:2},1032,["props"]),l(d,{key:"department",props:e},{default:u(()=>[c(n(e.row.department),1)]),_:2},1032,["props"]),l(d,{key:"category",props:e},{default:u(()=>[c(n(e.row.category),1)]),_:2},1032,["props"]),l(d,{key:"user",props:e},{default:u(()=>[c(n(e.row.user),1)]),_:2},1032,["props"]),l(d,{key:"created_at",props:e},{default:u(()=>[c(n(e.row.created_at),1)]),_:2},1032,["props"]),l(d,{key:"actions",props:e},{default:u(()=>[l(F,{color:"blue",name:"edit",onClick:Z=>ne(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),l(F,{color:"red",name:"delete",onClick:Z=>ue(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":u(()=>[l(D,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),placeholder:"Search",class:"q-mr-md"},{append:u(()=>[l(F,{name:"search"})]),_:1},8,["modelValue"]),l(_e,null,{default:u(()=>{var e;return[l(h,{onClick:oe,dense:"",color:"blue",size:"small",icon:"add",label:"Add"}),((e=r(M))==null?void 0:e.length)>0?(i(),C(h,{key:0,dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=Z=>ie(r(M)))})):H("",!0)]}),_:1})]),_:1},8,["rows","columns","pagination","filter"])),l(ye,{modelValue:B.value,"onUpdate:modelValue":a[10]||(a[10]=e=>B.value=e),persistent:""},{default:u(()=>[l(qe,{style:{width:"500px"}},{default:u(()=>[l(S,null,{default:u(()=>[x("div",Te,n(N.value),1)]),_:1}),l(S,{class:"q-pt-none"},{default:u(()=>[l(D,{outlined:"",dense:"",label:"Name",modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value=e)},null,8,["modelValue"])]),_:1}),l(S,{class:"q-pt-none"},{default:u(()=>[y.value?(i(),C(De,{key:1,class:"bg-primary text-white"},{default:u(()=>[l(ee,null,{default:u(()=>[Ie,l(J),l(h,{label:"INVENTORIES",outline:"",size:"sm",to:"/inventories"})]),_:1})]),_:1})):(i(),C(D,{key:0,outlined:"",dense:"",label:"Initial Quantity",modelValue:k.value,"onUpdate:modelValue":a[4]||(a[4]=e=>k.value=e),type:"number"},null,8,["modelValue"]))]),_:1}),l(ee,{class:"q-mb-sm"},{default:u(()=>[l(D,{outlined:"",dense:"",label:"Buying Price",modelValue:q.value,"onUpdate:modelValue":a[5]||(a[5]=e=>q.value=e),type:"number"},null,8,["modelValue"]),l(J),l(D,{outlined:"",dense:"",label:"Selling Price",modelValue:V.value,"onUpdate:modelValue":a[6]||(a[6]=e=>V.value=e),type:"number"},null,8,["modelValue"])]),_:1}),l(S,{class:"q-pt-none"},{default:u(()=>[l(K,{dense:"",outlined:"",modelValue:w.value,"onUpdate:modelValue":a[7]||(a[7]=e=>w.value=e),options:r(O),"option-value":"uuid","option-label":"name",label:"Select Product Category"},null,8,["modelValue","options"])]),_:1}),l(S,{class:"q-pt-none"},{default:u(()=>[l(K,{dense:"",outlined:"",modelValue:Q.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Q.value=e),options:r(R),"option-value":"uuid","option-label":"name",label:"Select Product Measurement"},null,8,["modelValue","options"])]),_:1}),l(S,{class:"q-pt-none"},{default:u(()=>[l(K,{dense:"",outlined:"",modelValue:P.value,"onUpdate:modelValue":a[9]||(a[9]=e=>P.value=e),options:r(j),"option-value":"uuid","option-label":"name",label:"Select Product Department"},null,8,["modelValue","options"])]),_:1}),x("div",$e,[x("small",null,n(v.value),1)]),l(ke,{align:"right"},{default:u(()=>[l(h,{flat:"",label:"Cancel",color:"red",onClick:de}),l(J),m.value&&!y.value?(i(),C(h,{key:0,flat:"",label:"Add Product",color:"primary",onClick:re,loading:b.value},null,8,["loading"])):H("",!0),m.value&&y.value?(i(),C(h,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:se,loading:b.value},null,8,["loading"])):H("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{oa as default};
