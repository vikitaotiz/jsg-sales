import{Q as i,a as ae}from"./QTr.ee5cc57e.js";import{Q as oe}from"./QBadge.c9e4b02c.js";import{c9 as re,c8 as se,r as y,j as le,aI as f,a5 as N,u as o,P as n,a3 as q,bb as s,b as ne,d as t,ac as m,a6 as h,bD as E,bE as k,a4 as T}from"./index.544437db.js";import{Q as w}from"./QInput.b3c42e3c.js";import{Q as ue}from"./QBtnGroup.f766cc8c.js";import{Q as de,a as ie,p as me,d as R,b as B,c as ce}from"./paginations.dead60bc.js";import{a as pe,Q as v}from"./QCard.b1d1b493.js";import{Q as _e}from"./QToolbar.cf5fbc2b.js";import{e as fe,a as ge}from"./excel.5d19a2ad.js";import{a as ye}from"./use-quasar.eb6615ed.js";import{a as ve,u as S}from"./index.a8c0ae15.js";import{p as G}from"./product_columns.33f8ffe3.js";import{u as be}from"./product-store.2669371c.js";import{u as Ve}from"./category-store.a6b0d2d4.js";import{g as ke,p as A}from"./module_calls.e16012c0.js";import{u as we}from"./department-store.512b6ce1.js";import"./use-dark.7de2cac8.js";import"./QSeparator.3296268e.js";import"./rtl.74f3c00c.js";import"./helpers.01ee3f07.js";const b=re(),c=b==null?void 0:b.token,Qe=se("measurements",{state:()=>({measurements:[]}),actions:{async fetchMeasurements(){if(c){const u=await ke("measurements",c);return this.measurements=u==null?void 0:u.data,this.measurements}},async createMeasurement(u){var p;if(u.uuid=(p=b==null?void 0:b.user)==null?void 0:p.uuid,c)return await A(u,"measurements",c)},async updateMeasurement(u){if(c)return await A(u,"update_measurement",c)},async deleteMeasurement(u){if(c)return await A(u,"delete_measurement",c)}}});const Pe={class:"q-pa-md"},Ce={key:0},qe={key:1},he={class:"text-h6"},Se={class:"text-center error_msg"},Je={__name:"Products",setup(u){const p=ye(),Q=ve(),P=be(),M=Ve(),L=Qe(),O=we(),x=me(10),_=y(!1),V=y(!1),U=y(""),C=y(""),$=y(""),g=y("");let r=le({name:"",quantity:1,category_id:"",buying_price:1,selling_price:1,measurement_id:"",department_id:""});const{data:D,isLoading:Y,isError:z}=S("products",()=>P.fetchProducts()),{data:j}=S("categories",()=>M.fetchCategories()),{data:F}=S("measurements",()=>L.fetchMeasurements()),{data:H}=S("departments",()=>O.fetchDepartments()),J=async l=>{if(confirm(`Continue with the operation. Delete ${l.name} ?`)){const e=await P.deleteProduct({uuid:l.uuid});e.status==="success"?(Q.refetchQueries("products"),d(e.message,"green","top")):d("There was an error","red","top-right")}},K=()=>{M.categories.length===0?d("You need to create at least one PRODUCT CATEGORY in order to create products!","orange","top"):(C.value="Add New Product",_.value=!0,V.value=!1)},W=l=>{console.log(l),V.value=!0,C.value=`Edit ${l.name}`,_.value=!0},X=async()=>{g.value="";const l={name:r.name.trim(),quantity:r.quantity,selling_price:r.selling_price,buying_price:r.buying_price,category_uuid:r.category_id.uuid,department_uuid:r.department_id.uuid,measurement_uuid:r.measurement_id.uuid};if(l.name&&l.selling_price&&l.buying_price){const a=await P.createProduct(l);a.status==="success"?(Q.refetchQueries("products"),r.name="",r.selling_price=1,r.buying_price=1,_.value=!1,d(a.message,"green","top")):(g.value=a.message,d(a.message,"red","top-right"))}else g.value="Name, Buying and Seeling prices  is required!",d("Name is required!","red","top-right")},Z=async()=>{const l={name:product_name.value.trim(),uuid:$.value};if(l.name){const a=await P.updateProduct(l);a.status==="success"?(Q.refetchQueries("products"),product_name.value="",_.value=!1,V.value=!1,C.value="",d(a.message,"green","top")):d("There was an error","red","top-right")}else g.value="Name is required!",d("Name is required!","red","top-right")},ee=()=>{_.value=!1,$.value="",g.value=""},d=(l,a,e)=>{p.notify({message:l,color:a,position:e})},te=l=>{const a=l.map(e=>({name:e.name,products:e.products.length,created_at:e.created_at}));fe(a,G,ge,p,"ProductsData")};return(l,a)=>(f(),N("div",Pe,[o(Y)?(f(),N("div",Ce,"Loading products...")):o(z)?(f(),N("div",qe,"An error has occurred: "+n(o(z)),1)):(f(),q(de,{key:2,title:"Products",rows:o(D),columns:o(G),pagination:o(x),"onUpdate:pagination":a[2]||(a[2]=e=>ne(x)?x.value=e:null),separator:"cell","row-key":"name",filter:U.value,dense:""},{body:s(e=>[t(ae,{props:e},{default:s(()=>[t(i,{key:"name",props:e},{default:s(()=>[m(n(e.row.name),1)]),_:2},1032,["props"]),t(i,{key:"measurement",props:e},{default:s(()=>[m(n(e.row.measurement)+" ",1),h("small",null,[t(oe,null,{default:s(()=>[m(": "+n(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),t(i,{key:"buying_price",props:e},{default:s(()=>[m(n(e.row.buying_price),1)]),_:2},1032,["props"]),t(i,{key:"selling_price",props:e},{default:s(()=>[m(n(e.row.selling_price),1)]),_:2},1032,["props"]),t(i,{key:"department",props:e},{default:s(()=>[m(n(e.row.department),1)]),_:2},1032,["props"]),t(i,{key:"category",props:e},{default:s(()=>[m(n(e.row.category),1)]),_:2},1032,["props"]),t(i,{key:"user",props:e},{default:s(()=>[m(n(e.row.user),1)]),_:2},1032,["props"]),t(i,{key:"created_at",props:e},{default:s(()=>[m(n(e.row.created_at),1)]),_:2},1032,["props"]),t(i,{key:"actions",props:e},{default:s(()=>[t(E,{color:"blue",name:"edit",onClick:I=>W(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(E,{color:"red",name:"delete",onClick:I=>J(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":s(()=>[t(w,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),placeholder:"Search",class:"q-mr-md"},{append:s(()=>[t(E,{name:"search"})]),_:1},8,["modelValue"]),t(ue,null,{default:s(()=>{var e;return[t(k,{onClick:K,dense:"",color:"blue",size:"small",icon:"add",label:"Add"}),((e=o(D))==null?void 0:e.length)>0?(f(),q(k,{key:0,dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=I=>te(o(D)))})):T("",!0)]}),_:1})]),_:1},8,["rows","columns","pagination","filter"])),t(ie,{modelValue:_.value,"onUpdate:modelValue":a[10]||(a[10]=e=>_.value=e),persistent:""},{default:s(()=>[t(pe,{style:{width:"500px"}},{default:s(()=>[t(v,null,{default:s(()=>[h("div",he,n(C.value),1)]),_:1}),t(v,{class:"q-pt-none"},{default:s(()=>[t(w,{outlined:"",dense:"",label:"Name",modelValue:o(r).name,"onUpdate:modelValue":a[3]||(a[3]=e=>o(r).name=e)},null,8,["modelValue"])]),_:1}),t(v,{class:"q-pt-none"},{default:s(()=>[t(w,{outlined:"",dense:"",label:"Quantity",modelValue:o(r).quantity,"onUpdate:modelValue":a[4]||(a[4]=e=>o(r).quantity=e),type:"number"},null,8,["modelValue"])]),_:1}),t(_e,{class:"q-mb-sm"},{default:s(()=>[t(w,{outlined:"",dense:"",label:"Buying Price",modelValue:o(r).buying_price,"onUpdate:modelValue":a[5]||(a[5]=e=>o(r).buying_price=e),type:"number"},null,8,["modelValue"]),t(R),t(w,{outlined:"",dense:"",label:"Selling Price",modelValue:o(r).selling_price,"onUpdate:modelValue":a[6]||(a[6]=e=>o(r).selling_price=e),type:"number"},null,8,["modelValue"])]),_:1}),t(v,{class:"q-pt-none"},{default:s(()=>[t(B,{dense:"",outlined:"",modelValue:o(r).category_id,"onUpdate:modelValue":a[7]||(a[7]=e=>o(r).category_id=e),options:o(j),"option-value":"uuid","option-label":"name",label:"Select Product Category"},null,8,["modelValue","options"])]),_:1}),t(v,{class:"q-pt-none"},{default:s(()=>[t(B,{dense:"",outlined:"",modelValue:o(r).measurement_id,"onUpdate:modelValue":a[8]||(a[8]=e=>o(r).measurement_id=e),options:o(F),"option-value":"uuid","option-label":"name",label:"Select Product Measurement"},null,8,["modelValue","options"])]),_:1}),t(v,{class:"q-pt-none"},{default:s(()=>[t(B,{dense:"",outlined:"",modelValue:o(r).department_id,"onUpdate:modelValue":a[9]||(a[9]=e=>o(r).department_id=e),options:o(H),"option-value":"uuid","option-label":"name",label:"Select Product Department"},null,8,["modelValue","options"])]),_:1}),h("div",Se,[h("small",null,n(g.value),1)]),t(ce,{align:"right"},{default:s(()=>[t(k,{flat:"",label:"Cancel",color:"red",onClick:ee}),t(R),o(r).name&&!V.value?(f(),q(k,{key:0,flat:"",label:"Add Product",color:"primary",onClick:X})):T("",!0),o(r).name&&V.value?(f(),q(k,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:Z})):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Je as default};
