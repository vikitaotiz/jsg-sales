import{Q as y,a as O}from"./QTr.401870aa.js";import{r as i,aI as d,a5 as Q,u as c,P as m,a3 as w,bb as s,d as t,ac as C,bD as R,bE as f,a6 as x,a4 as E}from"./index.104f6ae1.js";import{Q as D}from"./QInput.2343ca30.js";import{Q as P,c as j,f as G,d as H}from"./QCardActions.e5ce3c72.js";import{a as J,Q as A}from"./QCard.4f99fc1d.js";import{e as K,a as W}from"./excel.5d19a2ad.js";import{a as X}from"./use-quasar.f532f3dd.js";import{a as Y,u as Z}from"./index.3178a3ef.js";import{u as ee}from"./role-store.e7149611.js";import"./use-dark.abb6de42.js";import"./QSeparator.66c9c541.js";import"./rtl.9bf9d968.js";import"./module_calls.c637478d.js";import"./helpers.d60dad50.js";const T=[{name:"name",required:!0,label:"Name",align:"left",field:v=>v.name,format:v=>`${v}`,sortable:!0},{name:"users",align:"center",label:"Users",field:"users",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const ae={class:"q-pa-md"},te={key:0},le={key:1},se={class:"text-h6"},oe={class:"text-center error_msg"},be={__name:"Roles",setup(v){const N=X(),h=Y(),_=ee(),n=i(!1),p=i(!1),b=i(""),g=i(""),o=i(""),k=i(""),u=i(""),{data:V,isLoading:$,isError:q}=Z("roles",()=>_.fetchRoles()),S=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const e=await _.deleteRole({uuid:a.uuid});e.status==="success"?(h.refetchQueries("roles"),r(e.message,"green","top")):r("There was an error","red","top-right")}},B=()=>{g.value="Add New Role",n.value=!0,p.value=!1},U=a=>{p.value=!0,g.value=`Edit ${a.name}`,o.value=a.name,k.value=a.uuid,n.value=!0},z=async()=>{if(u.value="",o.value.trim()){const a=await _.createRole({name:o.value.trim()});a.status==="success"?(h.refetchQueries("roles"),o.value="",n.value=!1,r(a.message,"green","top")):(u.value=a.message,r(a.message,"red","top-right"))}else u.value="Name is required!",r("Name is required!","red","top-right")},I=async()=>{const a={name:o.value.trim(),uuid:k.value};if(a.name){const l=await _.updateRole(a);l.status==="success"?(h.refetchQueries("roles"),o.value="",n.value=!1,p.value=!1,g.value="",r(l.message,"green","top")):r("There was an error","red","top-right")}else u.value="Name is required!",r("Name is required!","red","top-right")},L=()=>{n.value=!1,o.value="",k.value="",u.value=""},r=(a,l,e)=>{N.notify({message:a,color:l,position:e})},F=a=>{const l=a.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));K(l,T,W,N,"RolesData")};return(a,l)=>(d(),Q("div",ae,[c($)?(d(),Q("div",te,"Loading roles...")):c(q)?(d(),Q("div",le,"An error has occurred: "+m(c(q)),1)):(d(),w(P,{key:2,title:"Roles",rows:c(V),columns:c(T),separator:"cell","row-key":"name",filter:b.value,dense:""},{body:s(e=>[t(O,{props:e},{default:s(()=>[t(y,{key:"name",props:e},{default:s(()=>[C(m(e.row.name),1)]),_:2},1032,["props"]),t(y,{key:"users",props:e},{default:s(()=>[C(m(e.row.users.length),1)]),_:2},1032,["props"]),t(y,{key:"created_at",props:e},{default:s(()=>[C(m(e.row.created_at),1)]),_:2},1032,["props"]),t(y,{key:"actions",props:e},{default:s(()=>[t(R,{color:"blue",name:"edit",onClick:M=>U(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(R,{color:"red",name:"delete",onClick:M=>S(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":s(()=>[t(D,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=e=>b.value=e),placeholder:"Search",class:"q-mr-md"},{append:s(()=>[t(R,{name:"search"})]),_:1},8,["modelValue"]),t(f,{onClick:B,round:"",dense:"",color:"primary",size:"small",icon:"add"}),t(f,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:l[1]||(l[1]=e=>F(c(V)))})]),_:1},8,["rows","columns","filter"])),t(j,{modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=e=>n.value=e),persistent:""},{default:s(()=>[t(J,{style:{width:"500px"}},{default:s(()=>[t(A,null,{default:s(()=>[x("div",se,m(g.value),1)]),_:1}),t(A,{class:"q-pt-none"},{default:s(()=>[t(D,{outlined:"",dense:"",label:"Name",modelValue:o.value,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value=e)},null,8,["modelValue"])]),_:1}),x("div",oe,[x("small",null,m(u.value),1)]),t(G,{align:"right"},{default:s(()=>[t(f,{flat:"",label:"Cancel",color:"red",onClick:L}),t(H),o.value&&!p.value?(d(),w(f,{key:0,flat:"",label:"Add Role",color:"primary",onClick:z})):E("",!0),o.value&&p.value?(d(),w(f,{key:1,flat:"",label:"Edit Role",color:"primary",onClick:I})):E("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{be as default};
