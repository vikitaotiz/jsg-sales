import{r as n,j as oe,aJ as c,a6 as w,d as t,bb as o,u as _,Q as u,a4 as g,ab as se,bE as f,ad as i,a5 as k,bD as R,a7 as d,N as re,bd as C,bw as U}from"./index.8298741d.js";import{Q as S}from"./QSpace.73238577.js";import{Q as F}from"./QBtnGroup.94e71e16.js";import{Q as ne}from"./QToolbar.cc0ad321.js";import{Q as $,a as M}from"./helpers.fb1c13fb.js";import{Q as b}from"./QTd.1a9ab2b5.js";import{Q as ue}from"./QTr.477990d2.js";import{Q as A}from"./QInput.7d552452.js";import{Q as ie}from"./QTable.7b930ac1.js";import{Q as de}from"./QCardActions.97fffd17.js";import{Q as L}from"./QDialog.8e5cc539.js";import{Q as z}from"./QSeparator.e342aaa8.js";import{C as O}from"./ClosePopup.ab5e4ff1.js";import{e as me,a as ce}from"./excel.5d19a2ad.js";import{u as fe}from"./use-quasar.6fd90df3.js";import{a as pe,u as _e,b as be}from"./index.aeab1b1a.js";import{h as y}from"./moment.9709ab41.js";import{u as ye}from"./sale-store.6a7d6a6a.js";import"./use-dark.d4d7a4ef.js";import"./use-key-composition.d158f3c1.js";import"./uid.9b787859.js";import"./QList.872f9e9f.js";import"./rtl.da2e2854.js";import"./module_calls.83889699.js";const j=[{name:"name",required:!0,label:"Name",align:"left",field:Q=>Q.name,format:Q=>`${Q}`,sortable:!0},{name:"quantity",align:"center",label:"Quantity",field:"quantity",sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"bill_ref",align:"center",label:"Bill Ref",field:"bill_ref",sortable:!0},{name:"payment_mode",align:"center",label:"Mode",field:"payment_mode",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0}];const ve={class:"q-pa-md"},ge={key:0},ke={key:1},Qe={class:"text-h6"},we={class:"text-center error_msg"},Ce={class:"text-center q-ma-sm"},Se=["max"],he=d("br",null,null,-1),xe={key:0},qe=["max"],Xe={__name:"Sales",setup(Q){const h=fe(),G=pe(),B=ye(),x=n(!1),q=n(!1),E=n(!1),D=n(""),J=n(""),v=n(""),W=n(""),N=n(""),V=n("Today"),H=n("2019/03/01"),K=n("2019/03/01"),P=new Date().toISOString().split("T")[0],r=oe({from:"",to:""}),X=()=>Y.value=!0,Y=n(!1),p=n([]),{isLoading:Z,isError:I}=_e("sales",()=>B.fetchSales(),{onSuccess:l=>{p.value=[],l==null||l.forEach(e=>{const s={name:e.name,quantity:e.quantity,status:e.status,bill_ref:e.bill_ref,payment_mode:e.payment_mode,user:e.user,created_at:e.created_at};p.value.push(s)})}}),ee=()=>{H.value=K.value;let l=y(r.from),e=y(r.to),s={};parseInt(l.diff(e,"seconds"))>=0?(s.from=r.from,s.to=r.to):(s.from=r.to,s.to=r.from),te(s),h.loading.show({message:`Please Wait. Fetching data between ${y(r.from).format("DD-MM-YYYY")} - ${y(r.to).format("DD-MM-YYYY")}`,boxClass:"bg-indigo text-white",spinnerColor:"white"})},{mutate:te}=be(l=>B.fetchSalesInDateRange(l),{onSuccess:l=>{var e,s,a;V.value=`(From: ${y(r.from).format("DD-MM-YYYY")} - To: ${y(r.to).format("DD-MM-YYYY")}). ${(e=l==null?void 0:l.data)==null?void 0:e.length} Records. Total Product Quantity: ${(s=l==null?void 0:l.data)==null?void 0:s.reduce((m,T)=>m+T.quantity,0)}`,h.loading.hide(),x.value=!0,p.value=[],(a=l==null?void 0:l.data)==null||a.forEach(m=>{const T={name:m.name,quantity:m.quantity,status:m.status,bill_ref:m.bill_ref,payment_mode:m.payment_mode,user:m.user,created_at:m.created_at};p.value.push(T)})}}),ae=()=>{q.value=!1,v.value="",W.value="",N.value=""},le=l=>{const e=l.map(s=>({name:s.name,sales:s.sales.length,created_at:s.created_at}));me(e,j,ce,h,"SalesData")};return(l,e)=>{var s;return c(),w("div",ve,[t($,{dark:"",class:"bg-primary q-mb-sm"},{default:o(()=>[t(ne,null,{default:o(()=>[t(f,{dense:"",flat:"",icon:"arrow_back",label:"Back",onClick:e[0]||(e[0]=a=>l.$router.back())}),t(S),i(u(V.value),1),t(S),t(F,null,{default:o(()=>[x.value?(c(),g(f,{key:0,icon:"autorenew",size:"sm",color:"orange",label:"Reset",onClick:e[1]||(e[1]=()=>{V.value="Today",_(G).refetchQueries("sales"),x.value=!1})})):k("",!0),t(f,{icon:"event",size:"sm",color:"indigo",label:"Calendar (Older Sales)",onClick:e[2]||(e[2]=a=>X())})]),_:1})]),_:1})]),_:1}),_(Z)?(c(),w("div",ge,"Loading sales...")):_(I)?(c(),w("div",ke,"An error has occurred: "+u(_(I)),1)):(c(),g(ie,{key:2,title:"Products Sold",rows:p.value,columns:_(j),separator:"cell","row-key":"name",filter:D.value,dense:""},se({body:o(a=>[t(ue,{props:a,class:re(`${a.row.status==="pending"?"pending-sale":""}`)},{default:o(()=>[t(b,{key:"name",props:a},{default:o(()=>[i(u(a.row.name),1)]),_:2},1032,["props"]),t(b,{key:"quantity",props:a},{default:o(()=>[i(u(a.row.quantity),1)]),_:2},1032,["props"]),t(b,{key:"status",props:a},{default:o(()=>[i(u(a.row.status),1)]),_:2},1032,["props"]),t(b,{key:"bill_ref",props:a},{default:o(()=>[d("b",null,"BILL-"+u(a.row.bill_ref),1)]),_:2},1032,["props"]),t(b,{key:"payment_mode",props:a},{default:o(()=>[i(u(a.row.payment_mode),1)]),_:2},1032,["props"]),t(b,{key:"user",props:a},{default:o(()=>[i(u(a.row.user),1)]),_:2},1032,["props"]),t(b,{key:"created_at",props:a},{default:o(()=>[i(u(a.row.created_at),1)]),_:2},1032,["props"])]),_:2},1032,["props","class"])]),_:2},[((s=p.value)==null?void 0:s.length)>0?{name:"top-right",fn:o(()=>[t(A,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=a=>D.value=a),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[t(R,{name:"search"})]),_:1},8,["modelValue"]),t(f,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:e[4]||(e[4]=a=>le(p.value))})]),key:"0"}:void 0]),1032,["rows","columns","filter"])),t(L,{modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=a=>q.value=a),persistent:""},{default:o(()=>[t($,{style:{width:"500px"}},{default:o(()=>[t(M,null,{default:o(()=>[d("div",Qe,u(J.value),1)]),_:1}),t(M,{class:"q-pt-none"},{default:o(()=>[t(A,{outlined:"",dense:"",label:"Name",modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a)},null,8,["modelValue"])]),_:1}),d("div",we,[d("small",null,u(N.value),1)]),t(de,{align:"right"},{default:o(()=>[t(f,{flat:"",label:"Cancel",color:"red",onClick:ae}),t(S),v.value&&!E.value?(c(),g(f,{key:0,flat:"",label:"Add Sale",color:"primary",onClick:l.addNewSale},null,8,["onClick"])):k("",!0),v.value&&E.value?(c(),g(f,{key:1,flat:"",label:"Edit Sale",color:"primary",onClick:l.editSelectedSale},null,8,["onClick"])):k("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:Y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>Y.value=a),persistent:""},{default:o(()=>[t($,{class:"bg-indigo text-white text-center q-pa-sm",style:{width:"300px"}},{default:o(()=>[d("div",Ce,[d("b",null,[t(R,{name:"events"}),i(" Date Picker")])]),t(z,{color:"white"}),t(M,null,{default:o(()=>[d("div",null,[i(" From : "),C(d("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=a=>r.from=a),max:_(P)},null,8,Se),[[U,r.from]])]),he,r.from?(c(),w("div",xe,[i(" To : "),C(d("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=a=>r.to=a),max:_(P)},null,8,qe),[[U,r.to]])])):k("",!0)]),_:1}),t(z,{color:"yellow"}),t(F,{flat:"",class:"full-width"},{default:o(()=>[C(t(f,{dense:"",label:"Cancel",color:"yellow",flat:""},null,512),[[O]]),t(S),r.to?C((c(),g(f,{key:0,dense:"",label:"Fetch Sales",color:"white",flat:"",onClick:ee},null,512)),[[O]]):k("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Xe as default};
