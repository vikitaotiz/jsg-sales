import{Q as k,a as ve}from"./QTr.cd6a50c5.js";import{Q as F,a as fe}from"./QBadge.77ac399d.js";import{bA as _e,c as ee,h as Y,bD as L,c9 as ge,c8 as be,r,aI as n,a5 as i,u as h,P as v,a3 as w,bb as o,b as ye,d as t,ac as U,F as ae,aO as le,a4 as A,bE as B,a6 as V}from"./index.54629b9a.js";import{Q as I}from"./QInput.92598606.js";import{Q as ke}from"./QBtnGroup.632ef586.js";import{u as he,a as we,b as Ue,Q as Ve,c as Qe,p as Ce,d as te,e as se,f as qe}from"./paginations.53f48ad5.js";import{a as xe,Q as Ae}from"./QCard.a98f9a97.js";import{e as Se,a as De}from"./excel.5d19a2ad.js";import{a as Ee}from"./use-quasar.8acf90c1.js";import{a as Ne,u as j}from"./index.da8d9231.js";import{g as Te,p as H}from"./module_calls.c637478d.js";import{u as Be}from"./role-store.c4e3d860.js";import{u as Ie}from"./department-store.e960d5a1.js";import"./use-dark.f6381175.js";import"./QSeparator.d04c4ca5.js";import"./rtl.5467f1aa.js";import"./helpers.d60dad50.js";var $e=_e({name:"QToggle",props:{...he,icon:String,iconColor:String},emits:we,setup(s){function u(_,Q){const $=ee(()=>(_.value===!0?s.checkedIcon:Q.value===!0?s.indeterminateIcon:s.uncheckedIcon)||s.icon),O=ee(()=>_.value===!0?s.iconColor:null);return()=>[Y("div",{class:"q-toggle__track"}),Y("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},$.value!==void 0?[Y(L,{name:$.value,color:O.value})]:void 0)]}return Ue("toggle",u)}});const oe=[{name:"name",required:!0,label:"Name",align:"left",field:s=>s.name,format:s=>`${s}`,sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"roles",align:"center",label:"Roles",field:"roles",sortable:!0},{name:"departments",align:"center",label:"Departments",field:"departments",sortable:!0},{name:"active",align:"center",label:"Status",field:"active",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],S=ge(),f=S==null?void 0:S.token,Re=be("users",{state:()=>({users:[]}),actions:{async fetchUsers(){if(f){const s=await Te("users",f);return this.users=s==null?void 0:s.data,this.users}},async createUser(s){var u;if(s.user_uuid=(u=S==null?void 0:S.user)==null?void 0:u.uuid,f)return await H(s,"users",f)},async updateUser(s){if(f)return await H(s,"update_user",f)},async deleteUser(s){if(f)return await H(s,"delete_user",f)}}});const Pe={class:"q-pa-md"},Fe={key:0},Le={key:1},Oe=V("br",null,null,-1),ze={key:0},Ge=V("small",null,"No Role Assigned",-1),Me=[Ge],Ye=V("br",null,null,-1),je={key:0},He=V("small",null,"No Department Assigned",-1),Je=[He],Ke={class:"text-h6"},We={class:"text-center error_msg"},fa={__name:"Users",setup(s){const u=Ee(),_=Ne(),Q=Re(),$=Be(),O=Ie(),z=Ce(10),D=r(!1),E=r(!1),g=r(!1),G=r(""),R=r(""),d=r(""),m=r(""),C=r(""),q=r(!0),c=r(""),b=r([]),x=r(""),J=r(""),P=r(""),K=r([]),W=r([]),{data:X,isLoading:re,isError:Z}=j("users",()=>Q.fetchUsers());j("roles",()=>$.fetchRoles(),{onSuccess:l=>{K.value=l.map(a=>({name:a.name,uuid:a.uuid}))}}),j("departments",()=>O.fetchDepartments(),{onSuccess:l=>{W.value=l.map(a=>({name:a.name,uuid:a.uuid}))}});const ne=async l=>{if(confirm(`Continue with the operation. Delete ${l.name} ?`)){const e=await Q.deleteUser({uuid:l.uuid});e.status==="success"?(_.refetchQueries("users"),p(e.message,"green","top")):p("There was an error","red","top-right")}},ue=()=>{R.value="Add New User",D.value=!0,E.value=!1},ie=l=>{q.value=!!l.active,E.value=!0;const a=l.departments.map(e=>e.name)[0];J.value=l.uuid,d.value=l.name,C.value=l.email,m.value=l.phone,c.value=l.password,x.value=l.departments.find(e=>e.name===a),b.value=l.roles.map(e=>({name:e.name,uuid:e.uuid})),R.value=`Edit ${l.name}`,D.value=!0},de=async()=>{g.value=!0;const l={name:d.value.trim(),active:q.value?1:0,email:C.value.trim(),phone:m.value.trim(),role_uuids:b.value.map(a=>a.uuid),department_uuid:x.value.uuid,password:c.value.trim()};if(l.name&&l.email&&l.password){const a=await Q.createUser(l);console.log(a),a.status==="success"?(_.refetchQueries("users"),g.value=!1,M(),p(a.message,"green","top")):(P.value=a.message,g.value=!1,p(a.message,"red","top-right"))}else g.value=!1,P.value="All fields are required!",p("All fields are required!","red","top-right")},me=async()=>{const l={user_uuid:J.value,name:d.value.trim(),active:q.value?1:0,email:C.value.trim(),phone:m.value?m.value.trim():m.value,role_uuids:b.value.map(a=>a.uuid),department_uuid:x.value.uuid,password:c.value?c.value.trim():c.value};if(l.name&&l.email&&b.value.length>0){const a=await Q.updateUser(l);a.status==="success"?(_.refetchQueries("users"),M(),p(a.message,"green","top")):p("There was an error","red","top-right")}else P.value="All fields are required!",p("All fields are required!","red","top-right")},ce=()=>M(),p=(l,a,e)=>{u.notify({message:l,color:a,position:e})},M=()=>{C.value="",d.value="",m.value="",b.value=[],x.value="",c.value="",D.value=!1,E.value=!1,R.value="",g.value=!1},pe=l=>{const a=l.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));Se(a,oe,De,u,"UsersData")};return(l,a)=>(n(),i("div",Pe,[h(re)?(n(),i("div",Fe,"Loading users...")):h(Z)?(n(),i("div",Le,"An error has occurred: "+v(h(Z)),1)):(n(),w(Ve,{key:2,title:"Users",rows:h(X),columns:h(oe),pagination:h(z),"onUpdate:pagination":a[2]||(a[2]=e=>ye(z)?z.value=e:null),separator:"cell","row-key":"name",filter:G.value,dense:""},{body:o(e=>[t(ve,{props:e},{default:o(()=>[t(k,{key:"name",props:e},{default:o(()=>[U(v(e.row.name),1)]),_:2},1032,["props"]),t(k,{key:"email",props:e},{default:o(()=>[U(v(e.row.email),1)]),_:2},1032,["props"]),t(k,{key:"roles",props:e},{default:o(()=>{var y,N;return[(n(!0),i(ae,null,le(e.row.roles,T=>(n(),i("div",{key:T.uuid},[t(F,{color:"blue"},{default:o(()=>[U(v(T.name),1)]),_:2},1024),Oe]))),128)),((N=(y=e.row)==null?void 0:y.roles)==null?void 0:N.length)===0?(n(),i("div",ze,Me)):A("",!0)]}),_:2},1032,["props"]),t(k,{key:"departments",props:e},{default:o(()=>{var y,N;return[(n(!0),i(ae,null,le(e.row.departments,T=>(n(),i("div",{key:T.uuid},[t(F,{color:"green"},{default:o(()=>[U(v(T.name),1)]),_:2},1024),Ye]))),128)),((N=(y=e.row)==null?void 0:y.departments)==null?void 0:N.length)===0?(n(),i("div",je,Je)):A("",!0)]}),_:2},1032,["props"]),t(k,{key:"active",props:e},{default:o(()=>[e.row.active?(n(),w(F,{key:0},{default:o(()=>[U(" Enabled ")]),_:1})):(n(),w(F,{key:1,color:"red"},{default:o(()=>[U(" Disbled ")]),_:1}))]),_:2},1032,["props"]),t(k,{key:"created_at",props:e},{default:o(()=>[U(v(e.row.created_at),1)]),_:2},1032,["props"]),t(k,{key:"actions",props:e},{default:o(()=>[e.row.name!=="Administrator"?(n(),w(L,{key:0,color:"blue",name:"edit",onClick:y=>ie(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"])):A("",!0),e.row.name!=="Administrator"?(n(),w(L,{key:1,color:"red",name:"delete",onClick:y=>ne(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])):A("",!0)]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":o(()=>[t(I,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:G.value,"onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[t(L,{name:"search"})]),_:1},8,["modelValue"]),t(ke,null,{default:o(()=>[t(B,{onClick:ue,dense:"",color:"primary",icon:"add",label:"Add"}),t(B,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=e=>pe(h(X)))})]),_:1})]),_:1},8,["rows","columns","pagination","filter"])),t(Qe,{modelValue:D.value,"onUpdate:modelValue":a[10]||(a[10]=e=>D.value=e),persistent:""},{default:o(()=>[t(xe,{style:{width:"500px"}},{default:o(()=>[t(fe,null,{default:o(()=>[V("div",Ke,v(R.value),1),t(te),t($e,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=e=>q.value=e),"checked-icon":"check",color:"green","unchecked-icon":"clear",label:`${q.value?"User active.":"User disabled."}`},null,8,["modelValue","label"])]),_:1}),t(Ae,{class:"q-pt-none"},{default:o(()=>[t(I,{class:"q-mb-sm",outlined:"",dense:"",label:"Name",modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=e=>d.value=e)},null,8,["modelValue"]),t(I,{class:"q-mb-sm",outlined:"",dense:"",label:"Phone (Optional)",modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value=e)},null,8,["modelValue"]),t(I,{class:"q-mb-sm",outlined:"",dense:"",label:"Email",modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=e=>C.value=e),type:"email"},null,8,["modelValue"]),t(se,{dense:"",multiple:"","use-chips":"",hint:"You can assign a user multiple roles.",outlined:"",modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=e=>b.value=e),options:K.value,"option-value":"uuid","option-label":"name",label:"Select Role",class:"q-mb-sm"},null,8,["modelValue","options"]),t(se,{dense:"",outlined:"",modelValue:x.value,"onUpdate:modelValue":a[8]||(a[8]=e=>x.value=e),options:W.value,"option-value":"uuid","option-label":"name",label:"Select Department",class:"q-mb-sm"},null,8,["modelValue","options"]),t(I,{class:"q-mb-sm",outlined:"",dense:"",label:"Password",modelValue:c.value,"onUpdate:modelValue":a[9]||(a[9]=e=>c.value=e),type:"password"},null,8,["modelValue"])]),_:1}),V("div",We,[V("small",null,v(P.value),1)]),t(qe,{align:"right"},{default:o(()=>[t(B,{flat:"",label:"Cancel",color:"red",onClick:ce}),t(te),d.value&&!E.value?(n(),w(B,{key:0,flat:"",label:"Add User",color:"primary",onClick:de,loading:g.value},null,8,["loading"])):A("",!0),d.value&&E.value?(n(),w(B,{key:1,flat:"",label:"Edit User",color:"primary",onClick:me,loading:g.value},null,8,["loading"])):A("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{fa as default};
